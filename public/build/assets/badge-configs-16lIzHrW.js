import{_ as p}from"./preload-helper-BfFHrpNk.js";import{ModernTable as B}from"https://cdn.jsdelivr.net/npm/modern-table-js@1.0.6/core/ModernTable.js";import{D as S}from"./delete-D9NIfc68.js";import{f as C,c as D,a as _,b as T,g as x,d as v}from"./formatDate-DZoGuVE6.js";import{h as A}from"./handlePermissionButtons-TMegtcb-.js";import{A as w}from"./ActionButton-4FF2Dtnd.js";import{s as d}from"./modalHandler-l1VpEcIP.js";import{f as I}from"./fetchAxios-BCs8Bycy.js";import{f as E,D as F}from"./DateRangePicker-pIMxf9xW.js";/* empty css                              */import"./axiosClient-DXQnQ5LA.js";import"./badgeUpdater-D7fo0NmU.js";import"./_commonjsHelpers-CqkleIqs.js";const M=x(),m={month:null,year:null,start_date:null,end_date:null,date:M},t={tableId:"#table-badge-configs",urlWeb:"/admin/badge-configs/",urlApi:"/api/badge-configs",deleteMultipleUrl:"/api/badge-configs/multiple/delete",tableName:"badge-configs",exportColumns:["menu_url","model_class"],createButtonText:"Add Badge Config",itemName:"badge-configs",pageLength:10,lengthMenu:[5,10,25,50],defaultOrder:[[0,"desc"]],dateRangeButtonText:"Filter Tanggal",apiErrorPrefix:"Badge Configs API Error:",dataLoadedMessage:"✅ Data loaded:",createButtonId:"btnTambah",bulkDeleteButtonId:"delete-selected-btn",dateRangeSelector:"#idFilterDateRange",dateRangeTextSelector:"#idFilterDateRange .date-range-text",actionButtonSelector:"#btnAction",formSelector:".FormAction",deleteButtonClass:".btn-delete",createButtonClass:".btnTambah",updateButtonClass:".buttonUpdate",showButtonClass:".buttonShow"};let u=!1,c={...m};const $=()=>u?Object.fromEntries(Object.entries(c).filter(([o,e])=>e!==null)):{},g=o=>{u=!0,c={...c,...o,date:null}},f=()=>{u=!1,c={...m}},L=_({buttonId:t.bulkDeleteButtonId,countSelector:".selected-count",onSelectionChange:(o,{count:e,hasSelection:a})=>{console.log(`ℹ️ Selection changed: ${e} ${t.itemName} selected`)}}),R=v({deleteUrl:t.deleteMultipleUrl,itemName:t.itemName,onSuccess:(o,e)=>{console.log("✅ Bulk delete success:",o.length,`${t.itemName} deleted`)},onError:o=>{console.error("❌ Bulk delete failed:",o)}});function k(){return C(new Date),{...D({url:t.urlApi,beforeSend:e=>Object.assign(e,$()),onSuccess:e=>{var n;const a=(n=e==null?void 0:e.meta)==null?void 0:n.permissions;a&&A(a)},onError:(e,a,n)=>{console.error(t.apiErrorPrefix,{error:e,status:a,message:n})}}),columns:[{data:"DT_RowIndex",title:"No",orderable:!1,searchable:!1},{data:"menu_url",title:"Menu URL",orderable:!0},{data:"model_class",title:"Model Class",orderable:!0},{data:"date_field",title:"Date Field",orderable:!0},{data:"is_active",title:"Status",orderable:!0,render:e=>{const a=e==1||e===!0;return`<span class="badge ${a?"bg-success":"bg-danger"}">${a?"Active":"Inactive"}</span>`}},{data:"description",title:"Description",orderable:!0},{data:"actions",title:"Action",className:"text-center",orderable:!1,searchable:!1,render:(e,a,n)=>w(n)}],buttons:T({tableName:t.tableName,exportColumns:t.exportColumns,bulkDeleteHandler:R,bulkDeleteButtonId:t.bulkDeleteButtonId,includeCreateButton:!0,createButtonId:t.createButtonId,createButtonText:t.createButtonText,createHandler:()=>{d(`${t.urlWeb}create`,"create")}}),pageLength:t.pageLength,lengthMenu:t.lengthMenu,order:t.defaultOrder,ordering:!0,searching:!0,columnSearch:!0,paging:!0,select:!0,responsive:!0,theme:"auto",onSelectionChange:L,onError:e=>console.error("❌ Table error:",e)}}function y(o,e,a){o||e?g({month:o||null,year:e||null}):f(),a.reload()}function N(o,e){if(o){g({start_date:o.start,end_date:o.end});const a=document.querySelector(t.dateRangeTextSelector);a&&(a.textContent=o.formatted)}else f();e.reload()}function b(){const o=k(),e=new B(t.tableId,{...o,initComplete:(a,n)=>{console.log(t.dataLoadedMessage,a.length,"records")}});return E((a,n)=>{y(a,n,e)}),new F(t.dateRangeSelector,{buttonText:t.dateRangeButtonText,onDateSelect:a=>{N(a,e)}}),e}function h(o){S({buttonSelector:t.deleteButtonClass,deleteUrl:t.urlApi+"/",tableSelector:t.tableId,onDeleteSuccess:()=>{o.reload(),o.clearSelection()}}),document.body.addEventListener("click",e=>{const a=e.target.closest(t.updateButtonClass),n=e.target.closest(t.showButtonClass),s=e.target.matches(t.actionButtonSelector);if(e.target.closest(t.createButtonClass))e.preventDefault(),d(`${t.urlWeb}create`,"create");else if(a){e.preventDefault();const r=`${t.urlWeb}${a.dataset.id}/edit`;d(r,"edit")}else if(n){e.preventDefault();const r=`${t.urlWeb}${n.dataset.id}`;d(r,"show")}else if(s){e.preventDefault();const r=document.querySelector(t.formSelector);r&&I({url:r.action,method:r.method,data:new FormData(r)},"simpan",()=>o.reload())}})}document.addEventListener("shown.bs.modal",async o=>{const e=o.target;(async()=>{try{const a=await p(()=>import("./tom-select.complete-Dc6LGOTC.js"),[]),n=a.default||a.TomSelect||a,s=e.querySelector("#date_fields");s&&!s.tomselect&&new n(s,{create:!0,maxItems:null,placeholder:"Pilih atau ketik field tanggal...",onCreate:function(l,r){if(!l||l.trim().length<2){r();return}const i=l.trim();if(!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(i)){showToast("Field name harus format valid (contoh: created_at, registration_date)","error"),r();return}r({value:i,text:i}),showToast(`Field '${i}' berhasil ditambahkan`,"success")},render:{option:function(l,r){return`<div>${r(l.text)}</div>`},item:function(l,r){return`<div>${r(l.text)}</div>`}}})}catch(a){console.error("Error loading select:",a)}})()});document.addEventListener("DOMContentLoaded",()=>{const o=b();h(o)});function K(){if(document.readyState!=="loading"){const o=b();h(o)}}export{K as default};

import m from"./axiosClient-DXQnQ5LA.js";async function h(s){try{await m.post("/api/menu/clear-badge-cache",{url:s});const c=await m.get("/api/menu/badge-count",{params:{url:s}});if(c.data.success){const{count:t,color:r}=c.data;p(s,t,r)}}catch(c){console.error("❌ Error updating menu badge:",c)}}function p(s,c,t){let r=document.querySelector(`a.nav-link[href="${s}"]`);if(!r){const e=window.location.origin+s;r=document.querySelector(`a.nav-link[href="${e}"]`)}if(!r){const e=s.split("/").pop(),o=document.querySelectorAll("a.nav-link");r=Array.from(o).find(n=>n.textContent.toLowerCase().trim().includes(e))}if(!r)return;const a=r.querySelector("p");if(!a)return;const l=a.querySelector(".badge");if(l&&l.remove(),c>0){const e=document.createElement("span");e.className=`badge bg-${t} ms-auto`,e.textContent=c;const o=a.querySelector(".nav-arrow");o?(e.classList.add("me-2"),a.insertBefore(e,o)):a.appendChild(e),e.style.animation="badgeUpdate 0.3s ease-in-out"}}async function g(s){try{await m.post("/api/menu/clear-badge-cache");const c=await m.get("/api/menu/all-badge-counts");if(c.data.success){const t=c.data.badges;Object.keys(t).forEach(r=>{const{count:a,color:l}=t[r];p(r,a,l)})}}catch{}}const b=document.createElement("style");b.textContent=`
    @keyframes badgeUpdate {
        0% { transform: scale(0.8); opacity: 0.5; }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
    }
`;document.head.appendChild(b);const T=Object.freeze(Object.defineProperty({__proto__:null,autoUpdateBadgeForUrl:g,updateMenuBadge:h},Symbol.toStringTag,{value:"Module"}));function k(s){var l;const t={...{buttonSelector:"",dataIdAttribute:"data-id",deleteUrl:"",confirmTitle:"Apakah Anda yakin?",confirmText:"Anda tidak akan dapat mengembalikan ini!",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Tidak",spinnerDuration:300,onDeleteSuccess:null},...s};(l=document.querySelector('meta[name="csrf-token"]'))==null||l.content;async function r(e,o){var n,i;a(o,!0);try{const u=typeof t.deleteUrl=="function"?t.deleteUrl(e):`${t.deleteUrl}${e}`,d=await m.delete(u,{data:{id:e}});if(d.data.status==="success"||d.data.success===!0){showToast(d.data.message,"success");const f=typeof t.deleteUrl=="function"?t.deleteUrl(e):t.deleteUrl;g(f),typeof t.onDeleteSuccess=="function"&&t.onDeleteSuccess(e,d.data)}else showToast(d.data.message||"Terjadi kesalahan","error")}catch(u){const d=((i=(n=u.response)==null?void 0:n.data)==null?void 0:i.message)||"Terjadi kesalahan, silakan coba lagi.";console.error("❌ Kesalahan:",d),showToast(d,"error")}finally{a(o,!1)}}function a(e,o){e.innerHTML=o?'<i class="fa fa-spin fa-spinner text-white"></i>':'<i class="fa fa-trash-alt text-danger"></i>'}document.body.addEventListener("click",e=>{const o=e.target.closest(t.buttonSelector);if(!o)return;e.preventDefault();const n=o.getAttribute(t.dataIdAttribute),i=o.innerHTML;a(o,!0),setTimeout(()=>{Swal.fire({title:t.confirmTitle,text:t.confirmText,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:t.confirmButtonText,cancelButtonText:t.cancelButtonText}).then(u=>{u.isConfirmed?r(n,o):o.innerHTML=i})},t.spinnerDuration)})}const B=s=>{const{deleteUrl:c,itemName:t="items",onSuccess:r,onError:a}=s;return(l,e)=>{const o=e.getSelectedRows();o.length!==0&&confirm(`Delete ${o.length} selected ${t}?`)&&m.post(c,{ids:o.map(n=>n.id)}).then(({data:n})=>{if((n==null?void 0:n.status)==="success")alert(`Successfully deleted ${o.length} ${t}!`),e.reload(),e.clearSelection(),r&&r(o,n);else{const i="Error: "+((n==null?void 0:n.message)??"Unknown error");alert(i),a&&a(new Error(i),n)}}).catch(n=>{console.error("Delete error:",n),alert(`Error deleting ${t}!`),a&&a(n)})}},y=(s={})=>{const{buttonId:c="delete-selected-btn",countSelector:t=".selected-count",buttonText:r="Delete ({count})",onSelectionChange:a}=s;return l=>{const e=document.getElementById(c);if(!e)return;const o=l.length>0,n=l.length;e.style.display=o?"inline-block":"none",e.disabled=!o;const i=e.querySelector(t);if(i&&(i.textContent=n),r.includes("{count}")&&o){const u=e.querySelector(".btn-text")||e,d=u.innerHTML;(d.includes("selected-count")||d.includes("{count}"))&&(u.innerHTML=r.replace("{count}",`<span class="selected-count">${n}</span>`))}a&&a(l,{count:n,hasSelection:o})}};y();const C=(s={})=>{var o;const{url:c,beforeSend:t,onSuccess:r,onError:a,onComplete:l,headers:e={}}=s;return{api:{url:c,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"X-CSRF-TOKEN":(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content,...e},beforeSend:n=>t?t(n):n,success:n=>{r&&r(n)},error:(n,i,u)=>{console.error("API Error:",{error:n,status:i,message:u}),a?a(n,i,u):typeof showToast<"u"?showToast(`Error: ${u}`,"error"):alert(`Error: ${u}`)},complete:()=>{l&&l()}}}},w=(s={})=>{const{tableName:c="items",exportColumns:t=["name"],bulkDeleteHandler:r,bulkDeleteButtonId:a="delete-selected-btn",includeBulkDelete:l=!0,includeCreateButton:e=!0,createButtonId:o="btnTambah",createHandler:n,createButtonText:i="Tambah",customButtons:u=[]}=s,d=new Date().toISOString().split("T")[0],f=[];return e&&f.push({id:o,text:`<i class="fas fa-plus"></i> ${i}`,className:"btn btn-primary btn-sm me-1 btnTambah",style:"display: none;",action:n||function(){console.log(`Create ${c} clicked`)}}),f.push("copy",{extend:"csv",text:"Export",className:"btn btn-success btn-sm btn-csv",filename:`${c}-export-${d}`,exportColumns:t,titleAttr:"Export data as CSV file (Excel compatible)"},{extend:"pdf",text:"PDF",className:"btn btn-danger btn-sm btn-pdf",filename:`${c}-report-${d}`,orientation:"landscape",pageSize:"A4",exportColumns:[...t,"status"],titleAttr:"Export data as PDF file"},{extend:"print",text:"Print",className:"btn btn-warning btn-sm btn-print",orientation:"portrait",exportColumns:t,titleAttr:"Print selected columns with custom styling"},"colvis"),l&&r&&f.push({text:'Delete Bulk (<span class="selected-count">0</span>)',className:"btn btn-danger btn-sm btn-delete",enabled:!1,attr:{id:a,style:"display: none;"},action:r}),u.length>0&&f.push(...u),f},x=s=>[s.getFullYear(),String(s.getMonth()+1).padStart(2,"0"),String(s.getDate()).padStart(2,"0")].join("-"),D=()=>x(new Date);export{k as D,y as a,w as b,C as c,B as d,g as e,x as f,D as g,T as h};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/rolesSelect-vaZ1Yc9r.js","assets/InitTomSelect-BFv3yElQ.js","assets/axiosClient-8LtfCK6A.js","assets/InitTomSelect-CR_xEeZJ.css"])))=>i.map(i=>d[i]);
import{_ as b}from"./preload-helper-BfFHrpNk.js";import{ModernTable as I}from"https://cdn.jsdelivr.net/npm/modern-table-js@1.0.6/core/ModernTable.js";import{D as w}from"./delete-QRht9yhg.js";import{f as x,c as P,a as M,b as k,g as R,d as F}from"./formatDate-Cz7pwXTf.js";import{h as N}from"./handlePermissionButtons-TMegtcb-.js";import{A as $}from"./ActionButton-4FF2Dtnd.js";import{f as U,D as q}from"./DateRangePicker-pIMxf9xW.js";import{i as B,f as H}from"./permissionsPopup-B0xN-n9d.js";import{s as c}from"./modalHandler-Bg5eHBCv.js";import{f as O}from"./fetchAxios-Cye8cR7v.js";import{M as h}from"./MediaLibrary-DzZMThYK.js";import"./axiosClient-8LtfCK6A.js";import"./badgeUpdater-D1PKXa5-.js";import"./_commonjsHelpers-CqkleIqs.js";window.initializeAvatar=function(){const t=document.getElementById("selectAvatarBtn");t&&t.addEventListener("click",function(e){e.preventDefault(),j()}),W()};async function j(){var t;try{const e=await fetch("/media-library/modal",{headers:{"X-CSRF-TOKEN":(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content,Accept:"application/json"}}),a=document.createElement("div");a.innerHTML=await e.text(),document.body.appendChild(a);const n=a.querySelector(".modal");if(n){const s=new bootstrap.Modal(n);s.show(),n.addEventListener("shown.bs.modal",function(){typeof h<"u"&&new h,z(n,s)}),n.addEventListener("hidden.bs.modal",function(){document.body.removeChild(a)})}}catch(e){console.error("Error loading media modal:",e),typeof toastr<"u"&&toastr.error("Gagal memuat media library")}}function z(t,e){const a=t.querySelector("#selectMediaForSettings");let n=null;function s(){const m=t.querySelectorAll(".media-item:not(.folder-item)");m.forEach(function(i){i.hasAttribute("data-avatar-listener")||(i.setAttribute("data-avatar-listener","true"),i.addEventListener("click",function(d){var p,g;d.target.closest("button")||d.target.type==="checkbox"||(m.forEach(function(L){L.classList.remove("selected")}),i.classList.add("selected"),n={id:i.dataset.id,url:i.dataset.url||((p=i.querySelector("img"))==null?void 0:p.src),name:i.dataset.name||((g=i.querySelector("img"))==null?void 0:g.alt)},a&&(a.disabled=!1))}))})}setTimeout(s,1e3);const l=new MutationObserver(s),o=t.querySelector("#mediaGrid");o&&l.observe(o,{childList:!0,subtree:!0}),a&&a.addEventListener("click",function(){n&&(G(n),e.hide())})}function G(t){const e=document.getElementById("avatarInput"),a=document.getElementById("avatarPreview");t&&t.url&&(e&&(e.value=t.url),a&&(a.src=t.url),typeof toastr<"u"&&toastr.success("Avatar berhasil dipilih dari Media Library"))}window.previewImage=function(){const t=document.querySelector("#avatar"),e=document.querySelector(".img-preview");if(t&&t.files&&t.files[0]){e.style.display="block";const a=new FileReader;a.readAsDataURL(t.files[0]),a.onload=function(n){e.src=n.target.result}}};function W(){w({buttonSelector:".btn-delete-avatar",deleteUrl:"/api/media/avatar/",confirmTitle:"Hapus Avatar?",confirmText:"Avatar akan dihapus dan diganti dengan avatar default.",confirmButtonText:"Ya, Hapus Avatar!",onDeleteSuccess:function(t,e){const a=document.getElementById("avatarPreview");a&&(a.src="/avatar/avatar-default.jpg");const n=document.getElementById("avatarInput");n&&(n.value="")}})}window.deleteAvatar=function(t){const e=document.createElement("button");e.className="btn-delete-avatar",e.setAttribute("data-id",t),e.click()};document.addEventListener("shown.bs.modal",function(t){t.target.id==="modalAction"&&initializeAvatar()});const V=R(),D={month:null,year:null,start_date:null,end_date:null,date:V};var v,y,S;const r={tableId:"#table-users",urlWeb:`${((v=window.APP_CONFIG)==null?void 0:v.baseUrl)||""}/admin/users/`,urlApi:`${((y=window.APP_CONFIG)==null?void 0:y.apiUrl)||"/api"}/users`,deleteMultipleUrl:`${((S=window.APP_CONFIG)==null?void 0:S.apiUrl)||"/api"}/users/multiple/delete`,tableName:"users",exportColumns:["name","email"],createButtonText:"Add User",itemName:"users",pageLength:10,lengthMenu:[5,10,25,50],defaultOrder:[[6,"desc"]],dateRangeButtonText:"Filter Tanggal",apiErrorPrefix:"Users API Error:",dataLoadedMessage:"✅ Data loaded:",createButtonId:"btnTambah",bulkDeleteButtonId:"delete-selected-btn",dateRangeSelector:"#idFilterDateRange",dateRangeTextSelector:"#idFilterDateRange .date-range-text",actionButtonSelector:"#btnAction",formSelector:".FormAction",deleteButtonClass:".btn-delete",createButtonClass:".btnTambah",updateButtonClass:".buttonUpdate",showButtonClass:".buttonShow"};let f=!1,u={...D};const Y=()=>f?Object.fromEntries(Object.entries(u).filter(([t,e])=>e!==null)):{},T=t=>{f=!0,u={...u,...t,date:null}},A=()=>{f=!1,u={...D}},K=M({buttonId:r.bulkDeleteButtonId,countSelector:".selected-count",onSelectionChange:(t,{count:e,hasSelection:a})=>{console.log(`ℹ️ Selection changed: ${e} ${r.itemName} selected`)}}),X=F({deleteUrl:r.deleteMultipleUrl,itemName:r.itemName,onSuccess:(t,e)=>{console.log("✅ Bulk delete success:",t.length,`${r.itemName} deleted`)},onError:t=>{console.error("❌ Bulk delete failed:",t)}});function J(){return x(new Date),{...P({url:r.urlApi,beforeSend:e=>Object.assign(e,Y()),onSuccess:e=>{var n;const a=(n=e==null?void 0:e.meta)==null?void 0:n.permissions;a&&N(a)},onError:(e,a,n)=>{console.error(r.apiErrorPrefix,{error:e,status:a,message:n})}}),columns:[{data:"DT_RowIndex",title:"No",orderable:!1,searchable:!1},{data:"avatar_url",title:"Avatar",orderable:!1,searchable:!1,render:(e,a,n)=>`<img src="${n.avatar_url||"/avatar/avatar-default.jpg"}" alt="Avatar" width="40" height="40" style="border-radius: 50%;">`},{data:"name",title:"Name",orderable:!0},{data:"email",title:"Email",orderable:!0},{data:"roles",title:"Roles",orderable:!1,render:(e,a,n)=>{var s;return(s=n.roles)!=null&&s.length?n.roles.map(l=>`<span class="badge bg-primary me-1">${l.name}</span>`).join(""):"-"}},{data:"permissions",title:"Permissions",orderable:!1,render:(e,a,n)=>H(n.permissions??[],n,"user")},{data:"created_at",title:"Created",orderable:!0,render:e=>new Date(e).toLocaleDateString("id-ID")},{data:"actions",title:"Action",className:"text-center",orderable:!1,searchable:!1,render:(e,a,n)=>$(n)}],buttons:k({tableName:r.tableName,exportColumns:r.exportColumns,bulkDeleteHandler:X,bulkDeleteButtonId:r.bulkDeleteButtonId,includeCreateButton:!0,createButtonId:r.createButtonId,createButtonText:r.createButtonText,createHandler:()=>{c(`${r.urlWeb}create`,"create")}}),pageLength:r.pageLength,lengthMenu:r.lengthMenu,order:r.defaultOrder,ordering:!0,searching:!0,columnSearch:!0,paging:!0,select:!0,responsive:!0,theme:"auto",keyboard:!1,accessibility:!0,stateSave:!0,stateDuration:3600,onSelectionChange:K,onError:e=>console.error("❌ Table error:",e)}}function Q(t,e,a){t||e?T({month:t||null,year:e||null}):A(),a.reload()}function Z(t,e){if(t){T({start_date:t.start,end_date:t.end});const a=document.querySelector(r.dateRangeTextSelector);a&&(a.textContent=t.formatted)}else A();e.reload()}function E(){const t=J(),e=new I(r.tableId,{...t,initComplete:(a,n)=>{console.log(r.dataLoadedMessage,a.length,"records")}});return U((a,n)=>{Q(a,n,e)}),new q(r.dateRangeSelector,{buttonText:r.dateRangeButtonText,onDateSelect:a=>{Z(a,e)}}),e}function _(t){w({buttonSelector:r.deleteButtonClass,deleteUrl:r.urlApi+"/",tableSelector:r.tableId,onDeleteSuccess:()=>{t.reload(),t.clearSelection()}}),document.body.addEventListener("click",e=>{const a=e.target.closest(r.updateButtonClass),n=e.target.closest(r.showButtonClass),s=e.target.matches(r.actionButtonSelector);if(e.target.closest(r.createButtonClass))e.preventDefault(),c(`${r.urlWeb}create`,"create");else if(a){e.preventDefault();const o=`${r.urlWeb}${a.dataset.id}/edit`;c(o,"edit")}else if(n){e.preventDefault();const o=`${r.urlWeb}${n.dataset.id}`;c(o,"show")}else if(s){e.preventDefault();const o=document.querySelector(r.formSelector);o&&O({url:o.action,method:o.method,data:new FormData(o)},"simpan",()=>t.reload())}})}function C(){document.addEventListener("shown.bs.modal",async e=>{const a=e.target;try{const{initializeRolesTomSelect:n}=await b(async()=>{const{initializeRolesTomSelect:s}=await import("./rolesSelect-vaZ1Yc9r.js");return{initializeRolesTomSelect:s}},__vite__mapDeps([0,1,2,3]));setTimeout(()=>{const s=a.querySelector("#roles")||a.querySelector(".role-select");if(s){const l=n(s);l&&l.ts&&(l.ts.on("change",function(){t(this.getValue())}),setTimeout(()=>{const o=l.ts.getValue();o&&o.length>0&&t(o)},300))}},100)}catch(n){console.error("Error loading roles select:",n)}});async function t(e){const a=document.getElementById("permission-badges");if(a){if(!e||e.length===0){a.innerHTML='<span class="badge bg-secondary">Pilih role untuk melihat permissions</span>';return}try{const{default:n}=await b(async()=>{const{default:o}=await import("./axiosClient-8LtfCK6A.js");return{default:o}},[]);a.innerHTML='<span class="badge bg-info"><i class="fa fa-spinner fa-spin"></i> Loading permissions...</span>';const l=(await n.get(`/api/roles/by-ids?ids=${e.join(",")}&include_permissions=true`)).data;if(l.permissions&&l.permissions.length>0){const o=[...new Set(l.permissions)],i=(await n.get(`/api/permissions/by-ids?ids=${o.join(",")}`)).data;i.data&&i.data.length>0?a.innerHTML=i.data.map(d=>`<span class="badge bg-primary me-1 mb-1">${d.name}</span>`).join("")+`<small class="text-muted ms-2">(${i.data.length} permissions)</small>`:a.innerHTML='<span class="badge bg-warning">No permissions found</span>'}else a.innerHTML='<span class="badge bg-warning">Role tidak memiliki permissions</span>'}catch(n){console.error("Error fetching permissions:",n),a.innerHTML='<span class="badge bg-danger">Error loading permissions</span>'}}}}document.addEventListener("DOMContentLoaded",()=>{const t=E();B(),_(t),C()});function pe(){if(document.readyState!=="loading"){const t=E();B(),_(t),C()}}export{pe as default};

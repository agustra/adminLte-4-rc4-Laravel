import f from"./axiosClient-DXQnQ5LA.js";import{e as p}from"./formatDate-B2IUMST6.js";const y=(t={})=>{const{createButtonId:e="btnTambah",deleteButtonId:a="delete-selected-btn",customButtons:s=[],onPermissionUpdate:r}=t;return n=>{const o=n||{},c=document.querySelector(`#${e}`);c&&(o.create?(c.style.display="block",c.disabled=!1):(c.style.display="none",c.disabled=!0));const i=document.querySelector(`#${a}`);i&&(o.delete?(i.style.display="none",i.disabled=!1):(i.style.display="none",i.disabled=!0)),s.forEach(({buttonId:d,permission:h,showWhenTrue:u=!0})=>{const l=document.querySelector(`#${d}`);if(l){const m=o[h];u?(l.style.display=m?"block":"none",l.disabled=!m):(l.style.display=m?"none":"block",l.disabled=m)}}),window.currentPermissions=o,r&&r(o)}},I=y();function g(t,e){const a=t.querySelector(".modal-header"),s=t.querySelector("#btnAction"),r=t.querySelector(".modal-title");if(!a||!s||!r)return;a.className="modal-header",a.style.display="flex",s.style.display="block";const n={create:{headerClass:["gradient-card"],btnClass:["gradient-card"],btnText:"💾 Save",title:"🗂️ Create Data"},edit:{headerClass:["gradient-card"],btnClass:[],btnText:"💾 Update",title:"🗂️ Update Data"},show:{headerClass:[],btnClass:[],btnText:"",title:""}},o=n[e]||n.show;e==="show"?(a.style.display="none",s.style.display="none"):(o.headerClass.length&&a.classList.add(...o.headerClass),o.btnClass.length&&s.classList.add(...o.btnClass),s.innerHTML=o.btnText,r.innerHTML=o.title)}function v(t,e,a){const s=document.querySelector("#modalAction");if(!s)return showToast("❌ Modal tidak ditemukan!","error");if(typeof t=="object"&&t.status==="error")return showToast(t.msg||"Terjadi kesalahan","error");if(typeof t!="string")return showToast("Response tidak valid","error");s.querySelector(".modal-dialog").innerHTML=t,s.classList.add("show"),s.style.display="block",setTimeout(()=>g(s,e),100);let r=bootstrap.Modal.getInstance(s);r||(r=new bootstrap.Modal(s)),r.show(),typeof a=="function"&&a()}function w(){const t=document.querySelector(".modal.show");if(t){const e=bootstrap.Modal.getInstance(t);e&&e.hide()}document.querySelectorAll(".modal").forEach(e=>{e.style.display="none",e.classList.remove("show")}),document.querySelectorAll(".modal-backdrop").forEach(e=>{e.remove()}),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""}const B=async(t="",e,a=null)=>{try{const s=await f.get(t);return v(s.data,e,a),s.data}catch(s){throw console.error("Error fetching data:",s.message),showToast(`Error: ${s.message}`,"error"),s}};function b(t,e){let a=t||{},s=!1;document.querySelectorAll("[data-name], input, select, textarea").forEach(r=>{r.classList.remove("is-invalid","is-valid");let n=r.closest(".ts-wrapper");n&&n.classList.remove("is-invalid","is-valid")}),document.querySelectorAll(".invalid-feedback").forEach(r=>{r.textContent="",r.style.display="none"}),Object.keys(a).forEach(r=>{var i,d,h,u;let n=r.replace(/\.\d+$/,""),o=document.querySelector(`[data-name="${n}"], [name="${n}"]`),c=((i=o==null?void 0:o.closest(".form-group"))==null?void 0:i.querySelector(".invalid-feedback"))||((d=o==null?void 0:o.closest(".input-group"))==null?void 0:d.querySelector(".invalid-feedback"))||document.querySelector(`.${n}_error`);if(o){o.classList.add("is-invalid");let l=o.closest(".ts-wrapper")||((h=document.querySelector(`#${o.id}_tomselect`))==null?void 0:h.closest(".ts-wrapper"))||((u=o.parentElement)==null?void 0:u.querySelector(".ts-wrapper"));l&&l.classList.add("is-invalid")}c&&(c.textContent=a[r][0],c.style.display="block"),s||(showToast(a[r][0],"error"),s=!0)}),typeof e=="function"&&e()}function S(t,e){if(t.response){const{status:a,data:s}=t.response;if(a===422){let r;if(s.errors)r=s.errors;else if(s.message&&typeof s.message=="object")r=s.message;else{showToast(s.message||"Terjadi kesalahan validasi","error");return}b(r,e)}else s&&s.message?showToast(s.message,"error"):showToast("Terjadi kesalahan, silakan coba lagi.","error")}else console.error("Network error:",t),showToast("Terjadi kesalahan jaringan. Coba lagi.","error")}function T(){f.get("/admin/api/menus/sidebar").then(t=>{if(t.data.success&&t.data.html){const e=document.querySelector("nav ul#navigation");if(e){const a=[];document.querySelectorAll(".nav-item.has-treeview.menu-open").forEach(o=>{const c=o.querySelector(".nav-link");c&&a.push(c.textContent.trim())});const n=new DOMParser().parseFromString(t.data.html,"text/html").querySelector("ul#navigation");n&&e&&e.tagName==="UL"&&(e.innerHTML=n.innerHTML),setTimeout(()=>{if(e){C();const c=window.location.pathname;document.querySelectorAll(".nav-link").forEach(i=>{const d=i.getAttribute("href");if(d){const h=d.replace(window.location.origin,"");if(c===h||c.startsWith(h.replace(/\/$/,"")+"/")){i.classList.add("active");const u=i.closest(".nav-item.has-treeview");u&&u.classList.add("menu-open")}}})}},200)}}}).catch(t=>{})}function C(){document.querySelectorAll(".nav-item.has-treeview > .nav-link").forEach(a=>{a.replaceWith(a.cloneNode(!0))}),document.querySelectorAll(".nav-item.has-treeview > .nav-link").forEach(a=>{a.addEventListener("click",k)});const e=document.getElementById("navigation");e&&(e.setAttribute("data-lte-toggle","treeview"),e.setAttribute("data-accordion","false"))}function k(t){t.preventDefault(),t.stopPropagation();const e=this.closest(".nav-item");e.querySelector(".nav-treeview")&&e.classList.toggle("menu-open")}function q(){var t;return(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content}function E(t,e){const{data:a}=t;if(a.status==="error"){showToast(a.message||"Terjadi kesalahan","error");return}a.message&&showToast(a.message,"success"),a.refresh_sidebar&&setTimeout(()=>{T()},500),w(),typeof e=="function"&&e(a)}async function L(t){if(!t.url){showToast("❌ URL tidak boleh kosong!","error");return}let e="GET";t.method&&typeof t.method=="string"&&(e=t.method.toUpperCase());try{const a=await f({method:e,url:t.url,data:t.data||{},headers:{"X-CSRF-TOKEN":q(),Accept:"application/json"}});E(a,t.callback)}catch(a){S(a,t.callback)}}class U{constructor(){this.cache=null,this.cacheKey="badge_config_urls",this.lastUpdated=null,this.cacheTimeout=300*1e3,this.loadFromStorage(),document.addEventListener("badgeConfigChanged",()=>{this.clearCache()})}async getActiveUrls(){return(!this.cache||this.isCacheExpired())&&await this.refreshCache(),this.cache||[]}async shouldUpdateBadge(e){const a=await this.getActiveUrls(),s=this.extractResource(e);return a.some(r=>{const n=this.extractResource(r);return s===n})}async refreshCache(){try{const e=await f.get("/api/menu/active-urls");e.data.success&&(this.cache=e.data.urls,this.lastUpdated=Date.now(),this.saveToStorage())}catch(e){console.error("❌ Error refreshing badge config cache:",e),this.cache=[]}}clearCache(){this.cache=null,this.lastUpdated=null,localStorage.removeItem(this.cacheKey),localStorage.removeItem(this.cacheKey+"_timestamp")}isCacheExpired(){return this.lastUpdated?Date.now()-this.lastUpdated>this.cacheTimeout:!0}loadFromStorage(){try{const e=localStorage.getItem(this.cacheKey),a=localStorage.getItem(this.cacheKey+"_timestamp");e&&a&&(this.cache=JSON.parse(e),this.lastUpdated=parseInt(a))}catch{this.clearCache()}}saveToStorage(){try{localStorage.setItem(this.cacheKey,JSON.stringify(this.cache)),localStorage.setItem(this.cacheKey+"_timestamp",this.lastUpdated.toString())}catch{}}extractPath(e){try{return e.replace(/^https?:\/\/[^\/]+/,"").split("?")[0].toLowerCase()}catch{return e.toLowerCase()}}extractResource(e){try{const s=this.extractPath(e).match(/\/(api|admin)\/([^/]+)/);return s?s[2]:null}catch{return null}}}const x=new U;function P(t,e,a){L({...t,actionType:e,callback:async function(...r){if(a&&typeof a=="function"&&a(...r),t.url)try{await x.shouldUpdateBadge(t.url)&&p(t.url)}catch(n){console.error("Error in badge update logic:",n)}}})}export{P as f,I as h,B as s};

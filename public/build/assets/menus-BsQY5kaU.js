import{ModernTable as g}from"https://cdn.jsdelivr.net/npm/modern-table-js@1.0.6/core/ModernTable.js";import{D as b}from"./delete-D9NIfc68.js";import{f as h,c as S,a as B,b as w,d as y,g as I}from"./formatDate-DZoGuVE6.js";import{h as D}from"./handlePermissionButtons-TMegtcb-.js";import{A as k}from"./ActionButton-4FF2Dtnd.js";import{s}from"./modalHandler-l1VpEcIP.js";import{f as T}from"./fetchAxios-BCs8Bycy.js";import{initializePermissionsTomSelect as C}from"./permissionsSelect-d09A7nZV.js";import{initializeRolesTomSelect as x}from"./rolesSelect-DOJlz329.js";import{f as v,D as A}from"./DateRangePicker-pIMxf9xW.js";import"./axiosClient-DXQnQ5LA.js";import"./badgeUpdater-D7fo0NmU.js";import"./InitTomSelect-Cq3HKCL2.js";import"./tom-select.complete-Dc6LGOTC.js";/* empty css                              */import"./_commonjsHelpers-CqkleIqs.js";const E=I(),u={month:null,year:null,start_date:null,end_date:null,date:E},o={tableId:"#table-menus",urlWeb:"/admin/menus/",urlApi:"/api/menus",deleteMultipleUrl:"/api/menus/multiple/delete",tableName:"menus",exportColumns:["name","url"],createButtonText:"Add Menu",itemName:"menus",pageLength:10,lengthMenu:[5,10,25,50],dateRangeButtonText:"Filter Tanggal",apiErrorPrefix:"Menus API Error:",createButtonId:"btnTambah",bulkDeleteButtonId:"delete-selected-btn",dateRangeSelector:"#idFilterDateRange",dateRangeTextSelector:"#idFilterDateRange .date-range-text",actionButtonSelector:"#btnAction",formSelector:".FormAction",deleteButtonClass:".btn-delete",createButtonClass:".btnTambah",updateButtonClass:".buttonUpdate",showButtonClass:".buttonShow"};let c=!1,i={...u};const M=()=>c?Object.fromEntries(Object.entries(i).filter(([t,e])=>e!==null)):{},d=t=>{c=!0,i={...i,...t,date:null}},f=()=>{c=!1,i={...u}},L=B({buttonId:o.bulkDeleteButtonId,countSelector:".selected-count",onSelectionChange:(t,{count:e,hasSelection:n})=>{console.log(`ℹ️ Selection changed: ${e} menus selected`)}}),P=y({deleteUrl:o.deleteMultipleUrl,itemName:o.itemName,onSuccess:(t,e)=>{console.log("✅ Bulk delete success:",t.length,"menus deleted")},onError:t=>{console.error("❌ Bulk delete failed:",t)}});function R(){return h(new Date),{...S({url:o.urlApi,beforeSend:e=>Object.assign(e,M()),onSuccess:e=>{var a;const n=(a=e==null?void 0:e.meta)==null?void 0:a.permissions;n&&D(n)},onError:(e,n,a)=>{console.error(o.apiErrorPrefix,{error:e,status:n,message:a})}}),columns:[{data:"DT_RowIndex",title:"No",orderable:!1,searchable:!1},{data:"name",title:"Name",orderable:!0},{data:"url",title:"URL",orderable:!0},{data:"icon",title:"Icon",orderable:!1,render:e=>e?`<i class="${e}"></i> ${e}`:"-"},{data:"permission",title:"Permission",orderable:!0},{data:"roles",title:"Roles",orderable:!1,render:(e,n,a)=>{if(!e)return'<span class="text-muted">All Roles</span>';if(typeof e=="string")try{e=JSON.parse(e)}catch{return'<span class="text-muted">All Roles</span>'}return!Array.isArray(e)||e.length===0?'<span class="text-muted">All Roles</span>':e.map(r=>`<span class="badge bg-info me-1">${r}</span>`).join("")}},{data:"parent_name",title:"Parent",orderable:!0,render:e=>e||"-"},{data:"order",title:"Order",orderable:!0},{data:"is_active",title:"Status",orderable:!0,render:e=>e=="aktif"?'<span class="badge bg-success">Aktif</span>':'<span class="badge bg-secondary">Inaktif</span>'},{data:"actions",title:"Action",className:"text-center",orderable:!1,searchable:!1,render:(e,n,a)=>k(a)}],buttons:w({tableName:o.tableName,exportColumns:o.exportColumns,bulkDeleteHandler:P,bulkDeleteButtonId:o.bulkDeleteButtonId,includeCreateButton:!0,createButtonId:o.createButtonId,createButtonText:o.createButtonText,createHandler:()=>{s(`${o.urlWeb}create`,"create")}}),pageLength:o.pageLength,lengthMenu:o.lengthMenu,order:[[1,"asc"]],ordering:!0,searching:!0,columnSearch:!0,paging:!0,select:!0,responsive:!0,theme:"auto",onSelectionChange:L,onError:e=>console.error("❌ Table error:",e)}}function N(t,e,n){t||e?d({month:t||null,year:e||null}):f(),n.reload()}function _(t,e){if(t){d({start_date:t.start,end_date:t.end});const n=document.querySelector(o.dateRangeTextSelector);n&&(n.textContent=t.formatted)}else f();e.reload()}function m(){const t=R(),e=new g(o.tableId,{...t,initComplete:(n,a)=>{console.log("✅ Data loaded:",n.length,"records")}});return v((n,a)=>{N(n,a,e)}),new A(o.dateRangeSelector,{buttonText:o.dateRangeButtonText,onDateSelect:n=>{_(n,e)}}),e}function p(t){b({buttonSelector:o.deleteButtonClass,deleteUrl:o.urlApi+"/",tableSelector:o.tableId,onDeleteSuccess:()=>{t.reload(),t.clearSelection()}}),document.body.addEventListener("click",e=>{const n=e.target.closest(o.updateButtonClass),a=e.target.closest(o.showButtonClass),r=e.target.matches(o.actionButtonSelector);if(e.target.closest(o.createButtonClass))e.preventDefault(),s(`${o.urlWeb}create`,"create");else if(n){e.preventDefault();const l=`${o.urlWeb}${n.dataset.id}/edit`;s(l,"edit")}else if(a){e.preventDefault();const l=`${o.urlWeb}${a.dataset.id}`;s(l,"show")}else if(r){e.preventDefault();const l=document.querySelector(o.formSelector);l&&T({url:l.action,method:l.method,data:new FormData(l)},"simpan",()=>t.reload())}})}window.menusModalListenerAttached||(document.addEventListener("shown.bs.modal",function(t){console.log("Modal shown!");const e=t.target,n=e.querySelector("#permission");C(n,{multiple:!1,grouped:!0,createSingle:!0});const a=e.querySelector("#roles");a&&x(a),$(t)}),window.menusModalListenerAttached=!0);window.toggleIconPicker=function(){const t=document.getElementById("icon-picker");if(!t)return;const e=t.style.display!=="none";t.style.display=e?"none":"block",e||window.populatePopularIcons()};window.populatePopularIcons=function(){const t=["fas fa-home","fas fa-user","fas fa-users","fas fa-cog","fas fa-chart-bar","fas fa-file","fas fa-folder","fas fa-edit","fas fa-trash","fas fa-plus","fas fa-search","fas fa-bell","fas fa-envelope","fas fa-calendar","fas fa-clock","fas fa-heart","fas fa-star","fas fa-bookmark","fas fa-tag","fas fa-shopping-cart"],e=document.getElementById("popular-icons");e&&(e.innerHTML="",t.forEach(n=>{const a=document.createElement("div");a.className="col-2 text-center mb-2",a.innerHTML=`
            <button type="button" class="btn btn-sm btn-outline-secondary" 
                    data-icon="${n}" title="${n}">
                <i class="${n}"></i>
            </button>
        `,a.querySelector("button").addEventListener("click",function(){window.selectIcon(n)}),e.appendChild(a)}))};window.selectIcon=function(t){const e=document.getElementById("icon"),n=document.getElementById("icon-preview"),a=document.getElementById("icon-picker");e&&(e.value=t),n&&(n.className=t),a&&(a.style.display="none")};function $(t){const e=t.target,n=e.querySelector("#icon-picker-btn");n&&n.addEventListener("click",function(r){r.preventDefault(),window.toggleIconPicker()});const a=e.querySelector("#icon");a&&a.addEventListener("input",function(){const r=e.querySelector("#icon-preview");r&&(r.className=this.value||"fas fa-home")})}document.addEventListener("DOMContentLoaded",()=>{const t=m();p(t)});function te(){if(console.log("🔗 Menus module initialized successfully!"),document.readyState!=="loading"){const t=m();p(t)}}export{te as default};

import{ModernTable as b}from"https://cdn.jsdelivr.net/npm/modern-table-js@1.0.6/core/ModernTable.js";import{D as g}from"./delete-QRht9yhg.js";import{f as h,c as B,a as S,b as w,d as I,g as D}from"./formatDate-Cz7pwXTf.js";import{h as k}from"./handlePermissionButtons-TMegtcb-.js";import{A as y}from"./ActionButton-4FF2Dtnd.js";import{s}from"./modalHandler-Bg5eHBCv.js";import{f as T}from"./fetchAxios-Cye8cR7v.js";import{initializePermissionsTomSelect as C}from"./permissionsSelect-C4tQQ7lD.js";import{f as v,D as E}from"./DateRangePicker-pIMxf9xW.js";import"./axiosClient-8LtfCK6A.js";import"./badgeUpdater-D1PKXa5-.js";import"./InitTomSelect-BFv3yElQ.js";import"./_commonjsHelpers-CqkleIqs.js";const x=D(),u={month:null,year:null,start_date:null,end_date:null,date:x},o={tableId:"#table-menus",urlWeb:"/admin/menus/",urlApi:"/api/menus",deleteMultipleUrl:"/api/menus/multiple/delete",tableName:"menus",exportColumns:["name","url"],createButtonText:"Add Menu",itemName:"menus",pageLength:10,lengthMenu:[5,10,25,50],dateRangeButtonText:"Filter Tanggal",apiErrorPrefix:"Menus API Error:",createButtonId:"btnTambah",bulkDeleteButtonId:"delete-selected-btn",dateRangeSelector:"#idFilterDateRange",dateRangeTextSelector:"#idFilterDateRange .date-range-text",actionButtonSelector:"#btnAction",formSelector:".FormAction",deleteButtonClass:".btn-delete",createButtonClass:".btnTambah",updateButtonClass:".buttonUpdate",showButtonClass:".buttonShow"};let c=!1,i={...u};const M=()=>c?Object.fromEntries(Object.entries(i).filter(([t,e])=>e!==null)):{},d=t=>{c=!0,i={...i,...t,date:null}},f=()=>{c=!1,i={...u}},A=S({buttonId:o.bulkDeleteButtonId,countSelector:".selected-count",onSelectionChange:(t,{count:e,hasSelection:n})=>{console.log(`â„¹ï¸ Selection changed: ${e} menus selected`)}}),L=I({deleteUrl:o.deleteMultipleUrl,itemName:o.itemName,onSuccess:(t,e)=>{console.log("âœ… Bulk delete success:",t.length,"menus deleted")},onError:t=>{console.error("âŒ Bulk delete failed:",t)}});function P(){return h(new Date),{...B({url:o.urlApi,beforeSend:e=>Object.assign(e,M()),onSuccess:e=>{var a;const n=(a=e==null?void 0:e.meta)==null?void 0:a.permissions;n&&k(n)},onError:(e,n,a)=>{console.error(o.apiErrorPrefix,{error:e,status:n,message:a})}}),columns:[{data:"DT_RowIndex",title:"No",orderable:!1,searchable:!1},{data:"name",title:"Name",orderable:!0},{data:"url",title:"URL",orderable:!0},{data:"icon",title:"Icon",orderable:!1,render:e=>e?`<i class="${e}"></i> ${e}`:"-"},{data:"permission",title:"Permission",orderable:!0},{data:"parent",title:"Parent",orderable:!0},{data:"order",title:"Order",orderable:!0},{data:"is_active",title:"Status",orderable:!0,render:e=>e=="aktif"?'<span class="badge bg-success">Aktif</span>':'<span class="badge bg-secondary">Inaktif</span>'},{data:"actions",title:"Action",className:"text-center",orderable:!1,searchable:!1,render:(e,n,a)=>y(a)}],buttons:w({tableName:o.tableName,exportColumns:o.exportColumns,bulkDeleteHandler:L,bulkDeleteButtonId:o.bulkDeleteButtonId,includeCreateButton:!0,createButtonId:o.createButtonId,createButtonText:o.createButtonText,createHandler:()=>{s(`${o.urlWeb}create`,"create")}}),pageLength:o.pageLength,lengthMenu:o.lengthMenu,order:[[1,"asc"]],ordering:!0,searching:!0,columnSearch:!0,paging:!0,select:!0,responsive:!0,theme:"auto",onSelectionChange:A,onError:e=>console.error("âŒ Table error:",e)}}function N(t,e,n){t||e?d({month:t||null,year:e||null}):f(),n.reload()}function F(t,e){if(t){d({start_date:t.start,end_date:t.end});const n=document.querySelector(o.dateRangeTextSelector);n&&(n.textContent=t.formatted)}else f();e.reload()}function m(){const t=P(),e=new b(o.tableId,{...t,initComplete:(n,a)=>{console.log("âœ… Data loaded:",n.length,"records")}});return v((n,a)=>{N(n,a,e)}),new E(o.dateRangeSelector,{buttonText:o.dateRangeButtonText,onDateSelect:n=>{F(n,e)}}),e}function p(t){g({buttonSelector:o.deleteButtonClass,deleteUrl:o.urlApi+"/",tableSelector:o.tableId,onDeleteSuccess:()=>{t.reload(),t.clearSelection()}}),document.body.addEventListener("click",e=>{const n=e.target.closest(o.updateButtonClass),a=e.target.closest(o.showButtonClass),l=e.target.matches(o.actionButtonSelector);if(e.target.closest(o.createButtonClass))e.preventDefault(),s(`${o.urlWeb}create`,"create");else if(n){e.preventDefault();const r=`${o.urlWeb}${n.dataset.id}/edit`;s(r,"edit")}else if(a){e.preventDefault();const r=`${o.urlWeb}${a.dataset.id}`;s(r,"show")}else if(l){e.preventDefault();const r=document.querySelector(o.formSelector);r&&T({url:r.action,method:r.method,data:new FormData(r)},"simpan",()=>t.reload())}})}window.menusModalListenerAttached||(document.addEventListener("shown.bs.modal",function(t){console.log("Modal shown!");const n=t.target.querySelector("#permission");C(n,{multiple:!1,grouped:!0,createSingle:!0}),R(t)}),window.menusModalListenerAttached=!0);window.toggleIconPicker=function(){const t=document.getElementById("icon-picker");if(!t)return;const e=t.style.display!=="none";t.style.display=e?"none":"block",e||window.populatePopularIcons()};window.populatePopularIcons=function(){const t=["fas fa-home","fas fa-user","fas fa-users","fas fa-cog","fas fa-chart-bar","fas fa-file","fas fa-folder","fas fa-edit","fas fa-trash","fas fa-plus","fas fa-search","fas fa-bell","fas fa-envelope","fas fa-calendar","fas fa-clock","fas fa-heart","fas fa-star","fas fa-bookmark","fas fa-tag","fas fa-shopping-cart"],e=document.getElementById("popular-icons");e&&(e.innerHTML="",t.forEach(n=>{const a=document.createElement("div");a.className="col-2 text-center mb-2",a.innerHTML=`
            <button type="button" class="btn btn-sm btn-outline-secondary" 
                    data-icon="${n}" title="${n}">
                <i class="${n}"></i>
            </button>
        `,a.querySelector("button").addEventListener("click",function(){window.selectIcon(n)}),e.appendChild(a)}))};window.selectIcon=function(t){const e=document.getElementById("icon"),n=document.getElementById("icon-preview"),a=document.getElementById("icon-picker");e&&(e.value=t),n&&(n.className=t),a&&(a.style.display="none")};function R(t){const e=t.target,n=e.querySelector("#icon-picker-btn");n&&n.addEventListener("click",function(l){l.preventDefault(),window.toggleIconPicker()});const a=e.querySelector("#icon");a&&a.addEventListener("input",function(){const l=e.querySelector("#icon-preview");l&&(l.className=this.value||"fas fa-home")})}document.addEventListener("DOMContentLoaded",()=>{const t=m();p(t)});function Q(){if(console.log("ðŸ”— Menus module initialized successfully!"),document.readyState!=="loading"){const t=m();p(t)}}export{Q as default};

import{M as g}from"./MediaLibrary-CRxHC4YD.js";import p from"./axiosClient-DXQnQ5LA.js";import"./badgeUpdater-D7fo0NmU.js";import"./modalHandler-l1VpEcIP.js";console.log("‚öôÔ∏è Settings module loading...");document.getElementById("spinner");function l(e,n){typeof window.showToast=="function"?window.showToast(e,n):typeof toastr<"u"?toastr[n](e):(console.log(`${n.toUpperCase()}: ${e}`),alert(e))}setTimeout(()=>{const e=document.getElementById("settingsForm");e&&(e.onsubmit=window.submitForm)},100);function w(){y(),h()}function y(){const e=document.getElementById("settingsForm");e&&(e.removeAttribute("onsubmit"),e.onsubmit=window.submitForm)}window.openMediaPicker=function(e){window.currentMediaField=e,v({inputId:e,previewId:e+"_preview"})};window.submitForm=async function(e){e.preventDefault(),e.stopPropagation();const n=document.getElementById("settingsForm"),t=n.querySelector('button[type="submit"]'),i=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="bi bi-arrow-repeat" style="animation: spin 1s linear infinite;"></i> Saving...';const o=new FormData(n);try{const a=(await p.post(n.action,o,{headers:{"Content-Type":"multipart/form-data"}})).data;if(console.log("Settings response:",a),a.message)l(a.message,"success"),t.innerHTML='<i class="bi bi-check-lg"></i> Saved!',t.classList.add("btn-success"),t.classList.remove("btn-primary"),setTimeout(()=>{window.location.reload()},1e3);else throw new Error("No message in response")}catch(r){console.error("Error:",r),l("Error saving settings","error"),t.innerHTML=i,t.disabled=!1}};function h(){console.log("üì∑ Media picker ready")}async function v(e){try{const n=await p.get("/media-library/modal",{headers:{Accept:"text/html"}}),t=document.createElement("div");t.innerHTML=n.data,document.body.appendChild(t);const i=t.querySelector(".modal");if(i){const o=new bootstrap.Modal(i);o.show(),i.addEventListener("shown.bs.modal",function(){typeof g<"u"&&new g,L(i,e,o)}),i.addEventListener("hidden.bs.modal",function(){document.body.removeChild(t)})}}catch(n){console.error("Error loading media modal:",n),l("Failed to load media library","error")}}function L(e,n,t){const i=e.querySelector("#selectMediaForSettings");let o=null;function r(){const d=e.querySelectorAll(".media-item:not(.folder-item)");d.forEach(function(s){s.hasAttribute("data-settings-listener")||(s.setAttribute("data-settings-listener","true"),s.addEventListener("click",function(u){var m,f;u.target.closest("button")||u.target.type==="checkbox"||(d.forEach(function(b){b.classList.remove("selected")}),s.classList.add("selected"),o={id:s.dataset.id,url:s.dataset.url||((m=s.querySelector("img"))==null?void 0:m.src),name:s.dataset.name||((f=s.querySelector("img"))==null?void 0:f.alt)},i&&(i.disabled=!1))}))})}setTimeout(r,1e3);const a=new MutationObserver(r),c=e.querySelector("#mediaGrid");c&&a.observe(c,{childList:!0,subtree:!0}),i&&i.addEventListener("click",function(){o&&(S(o,n),t.hide())})}function S(e,n){const t=document.getElementById(n.inputId),i=document.getElementById(n.previewId);if(e&&e.url){let o=e.name;if(e.url){const r=e.url.split("/media/");r.length>1&&(o=r[1])}t&&(t.value=o),i&&(i.innerHTML=`<img src="${e.url}" alt="Preview" class="img-thumbnail" style="max-height: 100px;">`),l("Media selected successfully","success")}}document.addEventListener("DOMContentLoaded",function(){console.log("Settings: DOM ready, initializing..."),w(),console.log("Settings: Initialization complete")});function F(){console.log("‚öôÔ∏è Settings module initialized successfully!")}export{F as default,w as initializeSettings,v as openMediaLibrary};

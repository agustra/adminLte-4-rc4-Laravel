const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/rolesSelect-DOJlz329.js","assets/InitTomSelect-Cq3HKCL2.js","assets/tom-select.complete-Dc6LGOTC.js","assets/axiosClient-DXQnQ5LA.js","assets/tom-select-CR_xEeZJ.css"])))=>i.map(i=>d[i]);
import{_ as m}from"./preload-helper-BfFHrpNk.js";import{ModernTable as D}from"https://cdn.jsdelivr.net/npm/modern-table-js@1.0.6/core/ModernTable.js";import{D as p,f as y,c as A,a as T,b as _,g as E,d as C}from"./formatDate-B2IUMST6.js";import{s as c,f as I,h as L}from"./fetchAxios-DNDRkkvY.js";import{A as x}from"./ActionButton-4FF2Dtnd.js";import{f as F,D as M}from"./DateRangePicker-pIMxf9xW.js";import{i as g,f as R}from"./permissionsPopup-33kLpmI4.js";import"./axiosClient-DXQnQ5LA.js";import"./_commonjsHelpers-CqkleIqs.js";window.initializeAvatar=function(){const t=document.getElementById("selectAvatarBtn");t&&t.addEventListener("click",function(e){e.preventDefault(),k()}),U()};function k(){console.log("üñºÔ∏è Opening FileManager for avatar selection"),window.currentAvatarSelection=!0;const t=window.open("/user-filemanager?type=image","FileManager","width=1000,height=700,scrollbars=yes,resizable=yes");if(console.log("üìÇ FileManager popup opened for avatar:",t),!t||t.closed){console.error("‚ùå Failed to open FileManager popup"),typeof toastr<"u"&&toastr.error("Failed to open FileManager. Please check popup blocker.");return}window.SetUrl=function(e,a){if(console.log("üìÅ FileManager avatar callback received:",{urls:e,file_path:a}),!window.currentAvatarSelection)return;const n=Array.isArray(e)?e[0]:e,s=(n==null?void 0:n.url)||n;console.log("üîó Avatar URL extracted:",s),s?(P({url:s,name:(n==null?void 0:n.name)||"avatar"}),t.close(),delete window.currentAvatarSelection,typeof toastr<"u"&&toastr.success("Avatar berhasil dipilih dari FileManager")):console.error("‚ùå No URL received from FileManager")}}function P(t){console.log("üñºÔ∏è Updating avatar with:",t);const e=document.getElementById("avatarInput"),a=document.getElementById("avatarPreview");t&&t.url&&(e&&(e.value=t.url,console.log("‚úÖ Avatar input updated:",t.url)),a&&(a.src=t.url,console.log("‚úÖ Avatar preview updated")))}window.previewImage=function(){const t=document.querySelector("#avatar"),e=document.querySelector(".img-preview");if(t&&t.files&&t.files[0]){e.style.display="block";const a=new FileReader;a.readAsDataURL(t.files[0]),a.onload=function(n){e.src=n.target.result}}};function U(){p({buttonSelector:".btn-delete-avatar",deleteUrl:"/api/media/avatar/",confirmTitle:"Hapus Avatar?",confirmText:"Avatar akan dihapus dan diganti dengan avatar default.",confirmButtonText:"Ya, Hapus Avatar!",onDeleteSuccess:function(t,e){const a=document.getElementById("avatarPreview");a&&(a.src="/storage/filemanager/images/public/avatar-default.webp");const n=document.getElementById("avatarInput");n&&(n.value="")}})}window.deleteAvatar=function(t){const e=document.createElement("button");e.className="btn-delete-avatar",e.setAttribute("data-id",t),e.click()};document.addEventListener("shown.bs.modal",function(t){t.target.id==="modalAction"&&initializeAvatar()});const N=E(),f={month:null,year:null,start_date:null,end_date:null,date:N},r={tableId:"#table-users",urlWeb:"/admin/users/",urlApi:"/api/users",deleteMultipleUrl:"/api/users/multiple/delete",tableName:"users",exportColumns:["name","email"],createButtonText:"Add User",itemName:"users",pageLength:10,lengthMenu:[5,10,25,50],dateRangeButtonText:"Filter Tanggal",apiErrorPrefix:"Users API Error:",dataLoadedMessage:"‚úÖ Data loaded:",createButtonId:"btnTambah",bulkDeleteButtonId:"delete-selected-btn",dateRangeSelector:"#idFilterDateRange",dateRangeTextSelector:"#idFilterDateRange .date-range-text",actionButtonSelector:"#btnAction",formSelector:".FormAction",deleteButtonClass:".btn-delete",createButtonClass:".btnTambah",updateButtonClass:".buttonUpdate",showButtonClass:".buttonShow"};let u=!1,d={...f};const $=()=>u?Object.fromEntries(Object.entries(d).filter(([t,e])=>e!==null)):{},b=t=>{u=!0,d={...d,...t,date:null}},v=()=>{u=!1,d={...f}},H=T({buttonId:r.bulkDeleteButtonId,countSelector:".selected-count",onSelectionChange:(t,{count:e,hasSelection:a})=>{console.log(`‚ÑπÔ∏è Selection changed: ${e} ${r.itemName} selected`)}}),z=C({deleteUrl:r.deleteMultipleUrl,itemName:r.itemName,onSuccess:(t,e)=>{console.log("‚úÖ Bulk delete success:",t.length,`${r.itemName} deleted`)},onError:t=>{console.error("‚ùå Bulk delete failed:",t)}});function q(){return y(new Date),{...A({url:r.urlApi,beforeSend:e=>Object.assign(e,$()),onSuccess:e=>{var n;const a=(n=e==null?void 0:e.meta)==null?void 0:n.permissions;a&&L(a)},onError:(e,a,n)=>{console.error(r.apiErrorPrefix,{error:e,status:a,message:n})}}),columns:[{data:"DT_RowIndex",title:"No",orderable:!1,searchable:!1},{data:"name",title:"Name",orderable:!0},{data:"email",title:"Email",orderable:!0},{data:"roles",title:"Roles",orderable:!1,render:(e,a,n)=>{var s;return(s=n.roles)!=null&&s.length?n.roles.map(l=>`<span class="badge bg-primary me-1">${l.name}</span>`).join(""):"-"}},{data:"permissions",title:"Permissions",orderable:!1,render:(e,a,n)=>R(n.permissions??[],n,"user")},{data:"created_at",title:"Created",orderable:!0,render:e=>new Date(e).toLocaleDateString("id-ID")},{data:"actions",title:"Action",className:"text-center",orderable:!1,searchable:!1,render:(e,a,n)=>x(n)}],buttons:_({tableName:r.tableName,exportColumns:r.exportColumns,bulkDeleteHandler:z,bulkDeleteButtonId:r.bulkDeleteButtonId,includeCreateButton:!0,createButtonId:r.createButtonId,createButtonText:r.createButtonText,createHandler:()=>{c(`${r.urlWeb}create`,"create")}}),pageLength:r.pageLength,lengthMenu:r.lengthMenu,order:[[0,"desc"]],ordering:!0,searching:!0,columnSearch:!0,paging:!0,select:!0,responsive:!0,theme:"auto",keyboard:!1,accessibility:!0,stateSave:!0,stateDuration:3600,onSelectionChange:H,onError:e=>console.error("‚ùå Table error:",e)}}function O(t,e,a){t||e?b({month:t||null,year:e||null}):v(),a.reload()}function W(t,e){if(t){b({start_date:t.start,end_date:t.end});const a=document.querySelector(r.dateRangeTextSelector);a&&(a.textContent=t.formatted)}else v();e.reload()}function h(){const t=q(),e=new D(r.tableId,{...t,initComplete:(a,n)=>{console.log(r.dataLoadedMessage,a.length,"records")}});return F((a,n)=>{O(a,n,e)}),new M(r.dateRangeSelector,{buttonText:r.dateRangeButtonText,onDateSelect:a=>{W(a,e)}}),e}function w(t){p({buttonSelector:r.deleteButtonClass,deleteUrl:r.urlApi+"/",tableSelector:r.tableId,onDeleteSuccess:()=>{t.reload(),t.clearSelection()}}),document.body.addEventListener("click",e=>{const a=e.target.closest(r.updateButtonClass),n=e.target.closest(r.showButtonClass),s=e.target.matches(r.actionButtonSelector);if(e.target.closest(r.createButtonClass))e.preventDefault(),c(`${r.urlWeb}create`,"create");else if(a){e.preventDefault();const o=`${r.urlWeb}${a.dataset.id}/edit`;c(o,"edit")}else if(n){e.preventDefault();const o=`${r.urlWeb}${n.dataset.id}`;c(o,"show")}else if(s){e.preventDefault();const o=document.querySelector(r.formSelector);o&&I({url:o.action,method:o.method,data:new FormData(o)},"simpan",()=>t.reload())}})}function S(){document.addEventListener("shown.bs.modal",async e=>{const a=e.target;try{const{initializeRolesTomSelect:n}=await m(async()=>{const{initializeRolesTomSelect:s}=await import("./rolesSelect-DOJlz329.js");return{initializeRolesTomSelect:s}},__vite__mapDeps([0,1,2,3,4]));setTimeout(()=>{const s=a.querySelector("#roles")||a.querySelector(".role-select");if(s){const l=n(s);l&&l.ts&&(l.ts.on("change",function(){t(this.getValue())}),setTimeout(()=>{const o=l.ts.getValue();o&&o.length>0&&t(o)},300))}},100)}catch(n){console.error("Error loading roles select:",n)}});async function t(e){const a=document.getElementById("permission-badges");if(a){if(!e||e.length===0){a.innerHTML='<span class="badge bg-secondary">Pilih role untuk melihat permissions</span>';return}try{const{default:n}=await m(async()=>{const{default:o}=await import("./axiosClient-DXQnQ5LA.js");return{default:o}},[]);a.innerHTML='<span class="badge bg-info"><i class="fa fa-spinner fa-spin"></i> Loading permissions...</span>';const l=(await n.get(`/api/roles/by-ids?ids=${e.join(",")}&include_permissions=true`)).data;if(l.permissions&&l.permissions.length>0){const o=[...new Set(l.permissions)],i=(await n.get(`/api/permissions/by-ids?ids=${o.join(",")}`)).data;i.data&&i.data.length>0?a.innerHTML=i.data.map(B=>`<span class="badge bg-primary me-1 mb-1">${B.name}</span>`).join("")+`<small class="text-muted ms-2">(${i.data.length} permissions)</small>`:a.innerHTML='<span class="badge bg-warning">No permissions found</span>'}else a.innerHTML='<span class="badge bg-warning">Role tidak memiliki permissions</span>'}catch(n){console.error("Error fetching permissions:",n),a.innerHTML='<span class="badge bg-danger">Error loading permissions</span>'}}}}document.addEventListener("DOMContentLoaded",()=>{const t=h();g(),w(t),S()});function te(){if(document.readyState!=="loading"){const t=h();g(),w(t),S()}}export{te as default};

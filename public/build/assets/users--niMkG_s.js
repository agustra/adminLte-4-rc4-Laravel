const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/rolesSelect-DSv9e2RQ.js","assets/InitTomSelect-CEYaOZ7F.js","assets/axiosClient-DXQnQ5LA.js","assets/InitTomSelect-CR_xEeZJ.css"])))=>i.map(i=>d[i]);
import{_ as b}from"./preload-helper-BfFHrpNk.js";import{ModernTable as _}from"https://cdn.jsdelivr.net/npm/modern-table-js@1.0.6/core/ModernTable.js";import{D as v}from"./delete-D9NIfc68.js";import{f as L,c as C,a as I,b as x,g as M,d as k}from"./formatDate-DZoGuVE6.js";import{h as R}from"./handlePermissionButtons-TMegtcb-.js";import{A as P}from"./ActionButton-4FF2Dtnd.js";import{f as F,D as N}from"./DateRangePicker-pIMxf9xW.js";import{i as y,f as $}from"./permissionsPopup-33kLpmI4.js";import{s as c}from"./modalHandler-l1VpEcIP.js";import{f as q}from"./fetchAxios-BCs8Bycy.js";import{M as h}from"./MediaLibrary-CRxHC4YD.js";import"./axiosClient-DXQnQ5LA.js";import"./badgeUpdater-D7fo0NmU.js";import"./_commonjsHelpers-CqkleIqs.js";window.initializeAvatar=function(){const t=document.getElementById("selectAvatarBtn");t&&t.addEventListener("click",function(e){e.preventDefault(),H()}),j()};async function H(){var t;try{const e=await fetch("/media-library/modal",{headers:{"X-CSRF-TOKEN":(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content,Accept:"application/json"}}),a=document.createElement("div");a.innerHTML=await e.text(),document.body.appendChild(a);const n=a.querySelector(".modal");if(n){const s=new bootstrap.Modal(n);s.show(),n.addEventListener("shown.bs.modal",function(){typeof h<"u"&&new h,U(n,s)}),n.addEventListener("hidden.bs.modal",function(){document.body.removeChild(a)})}}catch(e){console.error("Error loading media modal:",e),typeof toastr<"u"&&toastr.error("Gagal memuat media library")}}function U(t,e){const a=t.querySelector("#selectMediaForSettings");let n=null;function s(){const m=t.querySelectorAll(".media-item:not(.folder-item)");m.forEach(function(i){i.hasAttribute("data-avatar-listener")||(i.setAttribute("data-avatar-listener","true"),i.addEventListener("click",function(d){var p,g;d.target.closest("button")||d.target.type==="checkbox"||(m.forEach(function(A){A.classList.remove("selected")}),i.classList.add("selected"),n={id:i.dataset.id,url:i.dataset.url||((p=i.querySelector("img"))==null?void 0:p.src),name:i.dataset.name||((g=i.querySelector("img"))==null?void 0:g.alt)},a&&(a.disabled=!1))}))})}setTimeout(s,1e3);const l=new MutationObserver(s),o=t.querySelector("#mediaGrid");o&&l.observe(o,{childList:!0,subtree:!0}),a&&a.addEventListener("click",function(){n&&(O(n),e.hide())})}function O(t){const e=document.getElementById("avatarInput"),a=document.getElementById("avatarPreview");t&&t.url&&(e&&(e.value=t.url),a&&(a.src=t.url),typeof toastr<"u"&&toastr.success("Avatar berhasil dipilih dari Media Library"))}window.previewImage=function(){const t=document.querySelector("#avatar"),e=document.querySelector(".img-preview");if(t&&t.files&&t.files[0]){e.style.display="block";const a=new FileReader;a.readAsDataURL(t.files[0]),a.onload=function(n){e.src=n.target.result}}};function j(){v({buttonSelector:".btn-delete-avatar",deleteUrl:"/api/media/avatar/",confirmTitle:"Hapus Avatar?",confirmText:"Avatar akan dihapus dan diganti dengan avatar default.",confirmButtonText:"Ya, Hapus Avatar!",onDeleteSuccess:function(t,e){const a=document.getElementById("avatarPreview");a&&(a.src="/avatar/avatar-default.jpg");const n=document.getElementById("avatarInput");n&&(n.value="")}})}window.deleteAvatar=function(t){const e=document.createElement("button");e.className="btn-delete-avatar",e.setAttribute("data-id",t),e.click()};document.addEventListener("shown.bs.modal",function(t){t.target.id==="modalAction"&&initializeAvatar()});const z=M(),S={month:null,year:null,start_date:null,end_date:null,date:z},r={tableId:"#table-users",urlWeb:"/admin/users",urlApi:"/api/users",deleteMultipleUrl:"/api/users/multiple/delete",tableName:"users",exportColumns:["name","email"],createButtonText:"Add User",itemName:"users",pageLength:10,lengthMenu:[5,10,25,50],defaultOrder:[[6,"desc"]],dateRangeButtonText:"Filter Tanggal",apiErrorPrefix:"Users API Error:",dataLoadedMessage:"✅ Data loaded:",createButtonId:"btnTambah",bulkDeleteButtonId:"delete-selected-btn",dateRangeSelector:"#idFilterDateRange",dateRangeTextSelector:"#idFilterDateRange .date-range-text",actionButtonSelector:"#btnAction",formSelector:".FormAction",deleteButtonClass:".btn-delete",createButtonClass:".btnTambah",updateButtonClass:".buttonUpdate",showButtonClass:".buttonShow"};let f=!1,u={...S};const W=()=>f?Object.fromEntries(Object.entries(u).filter(([t,e])=>e!==null)):{},B=t=>{f=!0,u={...u,...t,date:null}},w=()=>{f=!1,u={...S}},G=I({buttonId:r.bulkDeleteButtonId,countSelector:".selected-count",onSelectionChange:(t,{count:e,hasSelection:a})=>{console.log(`ℹ️ Selection changed: ${e} ${r.itemName} selected`)}}),V=k({deleteUrl:r.deleteMultipleUrl,itemName:r.itemName,onSuccess:(t,e)=>{console.log("✅ Bulk delete success:",t.length,`${r.itemName} deleted`)},onError:t=>{console.error("❌ Bulk delete failed:",t)}});function Y(){return L(new Date),{...C({url:r.urlApi,beforeSend:e=>Object.assign(e,W()),onSuccess:e=>{var n;const a=(n=e==null?void 0:e.meta)==null?void 0:n.permissions;a&&R(a)},onError:(e,a,n)=>{console.error(r.apiErrorPrefix,{error:e,status:a,message:n})}}),columns:[{data:"DT_RowIndex",title:"No",orderable:!1,searchable:!1},{data:"avatar_url",title:"Avatar",orderable:!1,searchable:!1,render:(e,a,n)=>`<img src="${n.avatar_url||"/avatar/avatar-default.jpg"}" alt="Avatar" width="40" height="40" style="border-radius: 50%;">`},{data:"name",title:"Name",orderable:!0},{data:"email",title:"Email",orderable:!0},{data:"roles",title:"Roles",orderable:!1,render:(e,a,n)=>{var s;return(s=n.roles)!=null&&s.length?n.roles.map(l=>`<span class="badge bg-primary me-1">${l.name}</span>`).join(""):"-"}},{data:"permissions",title:"Permissions",orderable:!1,render:(e,a,n)=>$(n.permissions??[],n,"user")},{data:"created_at",title:"Created",orderable:!0,render:e=>new Date(e).toLocaleDateString("id-ID")},{data:"actions",title:"Action",className:"text-center",orderable:!1,searchable:!1,render:(e,a,n)=>P(n)}],buttons:x({tableName:r.tableName,exportColumns:r.exportColumns,bulkDeleteHandler:V,bulkDeleteButtonId:r.bulkDeleteButtonId,includeCreateButton:!0,createButtonId:r.createButtonId,createButtonText:r.createButtonText,createHandler:()=>{c(`${r.urlWeb}create`,"create")}}),pageLength:r.pageLength,lengthMenu:r.lengthMenu,order:r.defaultOrder,ordering:!0,searching:!0,columnSearch:!0,paging:!0,select:!0,responsive:!0,theme:"auto",keyboard:!1,accessibility:!0,stateSave:!0,stateDuration:3600,onSelectionChange:G,onError:e=>console.error("❌ Table error:",e)}}function K(t,e,a){t||e?B({month:t||null,year:e||null}):w(),a.reload()}function X(t,e){if(t){B({start_date:t.start,end_date:t.end});const a=document.querySelector(r.dateRangeTextSelector);a&&(a.textContent=t.formatted)}else w();e.reload()}function D(){const t=Y(),e=new _(r.tableId,{...t,initComplete:(a,n)=>{console.log(r.dataLoadedMessage,a.length,"records")}});return F((a,n)=>{K(a,n,e)}),new N(r.dateRangeSelector,{buttonText:r.dateRangeButtonText,onDateSelect:a=>{X(a,e)}}),e}function T(t){v({buttonSelector:r.deleteButtonClass,deleteUrl:r.urlApi+"/",tableSelector:r.tableId,onDeleteSuccess:()=>{t.reload(),t.clearSelection()}}),document.body.addEventListener("click",e=>{const a=e.target.closest(r.updateButtonClass),n=e.target.closest(r.showButtonClass),s=e.target.matches(r.actionButtonSelector);if(e.target.closest(r.createButtonClass))e.preventDefault(),c(`${r.urlWeb}create`,"create");else if(a){e.preventDefault();const o=`${r.urlWeb}${a.dataset.id}/edit`;c(o,"edit")}else if(n){e.preventDefault();const o=`${r.urlWeb}${n.dataset.id}`;c(o,"show")}else if(s){e.preventDefault();const o=document.querySelector(r.formSelector);o&&q({url:o.action,method:o.method,data:new FormData(o)},"simpan",()=>t.reload())}})}function E(){document.addEventListener("shown.bs.modal",async e=>{const a=e.target;try{const{initializeRolesTomSelect:n}=await b(async()=>{const{initializeRolesTomSelect:s}=await import("./rolesSelect-DSv9e2RQ.js");return{initializeRolesTomSelect:s}},__vite__mapDeps([0,1,2,3]));setTimeout(()=>{const s=a.querySelector("#roles")||a.querySelector(".role-select");if(s){const l=n(s);l&&l.ts&&(l.ts.on("change",function(){t(this.getValue())}),setTimeout(()=>{const o=l.ts.getValue();o&&o.length>0&&t(o)},300))}},100)}catch(n){console.error("Error loading roles select:",n)}});async function t(e){const a=document.getElementById("permission-badges");if(a){if(!e||e.length===0){a.innerHTML='<span class="badge bg-secondary">Pilih role untuk melihat permissions</span>';return}try{const{default:n}=await b(async()=>{const{default:o}=await import("./axiosClient-DXQnQ5LA.js");return{default:o}},[]);a.innerHTML='<span class="badge bg-info"><i class="fa fa-spinner fa-spin"></i> Loading permissions...</span>';const l=(await n.get(`/api/roles/by-ids?ids=${e.join(",")}&include_permissions=true`)).data;if(l.permissions&&l.permissions.length>0){const o=[...new Set(l.permissions)],i=(await n.get(`/api/permissions/by-ids?ids=${o.join(",")}`)).data;i.data&&i.data.length>0?a.innerHTML=i.data.map(d=>`<span class="badge bg-primary me-1 mb-1">${d.name}</span>`).join("")+`<small class="text-muted ms-2">(${i.data.length} permissions)</small>`:a.innerHTML='<span class="badge bg-warning">No permissions found</span>'}else a.innerHTML='<span class="badge bg-warning">Role tidak memiliki permissions</span>'}catch(n){console.error("Error fetching permissions:",n),a.innerHTML='<span class="badge bg-danger">Error loading permissions</span>'}}}}document.addEventListener("DOMContentLoaded",()=>{const t=D();y(),T(t),E()});function ue(){if(document.readyState!=="loading"){const t=D();y(),T(t),E()}}export{ue as default};

import{ModernTable as p}from"https://cdn.jsdelivr.net/npm/modern-table-js@1.0.6/core/ModernTable.js";import{A as g}from"./ActionButton-4FF2Dtnd.js";import{f as b}from"./permissionsPopup-33kLpmI4.js";import{f as h,D as S}from"./DateRangePicker-pIMxf9xW.js";import"./preload-helper-BfFHrpNk.js";import"./_commonjsHelpers-CqkleIqs.js";const i=new Date,d=i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0");let c=!1,s={month:null,year:null,start_date:null,end_date:null,date:d};const u={tableId:"#usersTable",urlApi:"/api/users"};function y(){if(!c)return{date:d};const t={};return Object.entries(s).forEach(([a,e])=>{e!==null&&(t[a]=e)}),t}function m(t){c=!0,s.date=null,Object.assign(s,t)}function f(){c=!1,s={month:null,year:null,start_date:null,end_date:null,date:d}}function D(t){const a=document.getElementById("delete-selected-btn");if(a){a.style.display=t.length>0?"inline-block":"none",a.disabled=t.length===0;const e=a.querySelector(".selected-count");e&&(e.textContent=t.length)}}function x(t,a,e,r){var l;const n=a.getSelectedRows();n.length>0&&confirm(`Delete ${n.length} selected users?`)&&fetch("/api/users/bulk-delete",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content},body:JSON.stringify({ids:n.map(o=>o.id)})}).then(o=>o.json()).then(()=>{alert(`Successfully deleted ${n.length} users!`),a.reload()}).catch(o=>{console.error("Delete error:",o),alert("Error deleting users!")})}function C(){var a;const t=new Date().toISOString().split("T")[0];return{api:{url:u.urlApi,headers:{Authorization:"Bearer "+localStorage.getItem("token"),"X-CSRF-TOKEN":(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content},beforeSend:e=>Object.assign(e,y())},columns:[{data:"DT_RowIndex",title:"No",orderable:!1,searchable:!1},{data:"avatar_url",title:"Avatar",orderable:!1,searchable:!1,render:(e,r,n)=>`<img src="${n.avatar_url||"/storage/filemanager/images/public/avatar-default.webp"}" alt="Avatar" width="40" height="40" style="border-radius: 50%;">`},{data:"name",title:"Name",orderable:!0},{data:"email",title:"Email",orderable:!0},{data:"roles",title:"Roles",orderable:!1,render:(e,r,n)=>!n.roles||n.roles.length===0?"-":n.roles.map(l=>`<span class="badge bg-primary me-1">${l.name}</span>`).join("")},{data:"permissions_count",title:"Permissions",orderable:!1,render:(e,r,n)=>b(n.permissions||[],n,"user")},{data:"created_at",title:"Created",orderable:!0,render:e=>new Date(e).toLocaleDateString("id-ID")},{data:"actions",title:"Action",className:"text-center",orderable:!1,searchable:!1,render:(e,r,n)=>g(n)}],buttons:["copy",{extend:"csv",text:"Export",className:"btn btn-success btn-sm btn-csv",titleAttr:"Export data as CSV file (Excel compatible)",filename:`users-export-${t}`,exportColumns:["name","email"]},{extend:"pdf",text:"PDF",className:"btn btn-danger btn-sm btn-pdf",titleAttr:"Export data as PDF file",filename:`users-report-${t}`,orientation:"landscape",pageSize:"A4",exportColumns:["name","email","status"]},{extend:"print",text:"Print",className:"btn btn-warning btn-sm btn-print",titleAttr:"Print selected columns with custom styling",exportColumns:["name","email"],orientation:"portrait"},"colvis",{text:'Delete Bulk (<span class="selected-count">0</span>)',className:"btn btn-danger btn-sm btn-delete",enabled:!1,attr:{id:"delete-selected-btn",style:"display: none;"},action:x}],pageLength:10,lengthMenu:[5,10,25,50],ordering:!0,searching:!0,columnSearch:!0,paging:!0,select:!0,responsive:!0,theme:"auto",keyboard:!1,accessibility:!0,stateSave:!0,stateDuration:3600,onSelectionChange:D,onError:e=>console.error("❌ Table error:",e)}}function T(t,a,e){t||a?m({month:t||null,year:a||null}):f(),e.reload()}function A(t,a){if(t){m({start_date:t.start,end_date:t.end});const e=document.querySelector("#idFilterDateRange .date-range-text");e&&(e.textContent=t.formatted)}else f();a.reload()}function v(){const t=C(),a=new p(u.tableId,{...t,initComplete:(e,r)=>{console.log("✅ Data loaded:",e.length,"records")},onRowClick:(e,r)=>{console.log("👆 Row clicked:",e)}});return h((e,r)=>{T(e,r,a)}),new S("#idFilterDateRange",{buttonText:"Filter Tanggal",onDateSelect:e=>{A(e,a)}}),a}document.addEventListener("DOMContentLoaded",()=>{v()});

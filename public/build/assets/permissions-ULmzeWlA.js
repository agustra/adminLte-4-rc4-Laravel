import{ModernTable as p}from"https://cdn.jsdelivr.net/npm/modern-table-js@1.0.6/core/ModernTable.js";import{D as g,f as h,c as B,a as D,b as S,d as C}from"./formatDate-B2IUMST6.js";import{s as l,f as T,h as x}from"./fetchAxios-DNDRkkvY.js";import{A as I}from"./ActionButton-4FF2Dtnd.js";import{f as w,D as A}from"./DateRangePicker-pIMxf9xW.js";import{initializeRolesTomSelect as E}from"./rolesSelect-DOJlz329.js";import"./axiosClient-DXQnQ5LA.js";import"./_commonjsHelpers-CqkleIqs.js";import"./InitTomSelect-Cq3HKCL2.js";import"./tom-select.complete-Dc6LGOTC.js";/* empty css                              */const c={month:null,year:null,start_date:null,end_date:null},r={tableId:"#table-permissions",urlWeb:"/admin/permissions/",urlApi:"/api/permissions",deleteMultipleUrl:"/api/permissions/multiple/delete",tableName:"permissions",exportColumns:["name"],createButtonText:"Add Permission",itemName:"permissions",createButtonId:"btnTambah",bulkDeleteButtonId:"delete-selected-btn",dateRangeSelector:"#idFilterDateRange",dateRangeTextSelector:"#idFilterDateRange .date-range-text",actionButtonSelector:"#btnAction",formSelector:".FormAction",deleteButtonClass:".btn-delete",createButtonClass:".btnTambah",updateButtonClass:".buttonUpdate",showButtonClass:".buttonShow"};let i=!1,s={...c};const k=()=>i?Object.fromEntries(Object.entries(s).filter(([t,e])=>e!==null)):{},u=t=>{i=!0,s={...s,...t,date:null}},d=()=>{i=!1,s={...c}},y=D({buttonId:r.bulkDeleteButtonId,countSelector:".selected-count",onSelectionChange:(t,{count:e,hasSelection:o})=>{console.log(`ℹ️ Selection changed: ${e} permissions selected`)}}),F=C({deleteUrl:r.deleteMultipleUrl,itemName:r.itemName,onSuccess:(t,e)=>{console.log("✅ Bulk delete success:",t.length,"permissions deleted")},onError:t=>{console.error("❌ Bulk delete failed:",t)}});function v(){return h(new Date),{...B({url:r.urlApi,beforeSend:e=>Object.assign(e,k()),onSuccess:e=>{var n;const o=(n=e==null?void 0:e.meta)==null?void 0:n.permissions;o&&x(o)},onError:(e,o,n)=>{console.error("Permissions API Error:",{error:e,status:o,message:n})}}),columns:[{data:"DT_RowIndex",title:"No",orderable:!1,searchable:!1},{data:"name",title:"Permission Name",orderable:!0},{data:"roles",title:"Roles Name",orderable:!0},{data:"created_at",title:"Created",orderable:!0,render:e=>new Date(e).toLocaleDateString("id-ID")},{data:"actions",title:"Action",className:"text-center",orderable:!1,searchable:!1,render:(e,o,n)=>I(n)}],buttons:S({tableName:r.tableName,exportColumns:r.exportColumns,bulkDeleteHandler:F,bulkDeleteButtonId:r.bulkDeleteButtonId,includeCreateButton:!0,createButtonId:r.createButtonId,createButtonText:r.createButtonText,createHandler:()=>{l(`${r.urlWeb}create`,"create")}}),pageLength:10,lengthMenu:[5,10,25,50],ordering:!0,searching:!0,columnSearch:!0,paging:!0,select:!0,responsive:!0,theme:"auto",keyboard:!1,accessibility:!0,stateSave:!0,stateDuration:3600,onSelectionChange:y,onError:e=>console.error("❌ Table error:",e)}}function _(t,e,o){t||e?u({month:t||null,year:e||null}):d(),o.reload()}function N(t,e){if(t){u({start_date:t.start,end_date:t.end});const o=document.querySelector(r.dateRangeTextSelector);o&&(o.textContent=t.formatted)}else d();e.reload()}function m(){const t=v(),e=new p(r.tableId,{...t,initComplete:(o,n)=>{console.log("✅ Data loaded:",o.length,"records")}});return w((o,n)=>{_(o,n,e)}),new A(r.dateRangeSelector,{buttonText:"Filter Tanggal",onDateSelect:o=>{N(o,e)}}),e}function f(t){g({buttonSelector:r.deleteButtonClass,deleteUrl:r.urlApi+"/",tableSelector:r.tableId,onDeleteSuccess:()=>{t.reload(),t.clearSelection()}}),document.body.addEventListener("click",e=>{const o=e.target.closest(r.updateButtonClass),n=e.target.closest(r.showButtonClass),b=e.target.matches(r.actionButtonSelector);if(e.target.closest(r.createButtonClass))e.preventDefault(),l(`${r.urlWeb}create`,"create");else if(o){e.preventDefault();const a=`${r.urlWeb}${o.dataset.id}/edit`;l(a,"edit")}else if(n){e.preventDefault();const a=`${r.urlWeb}${n.dataset.id}`;l(a,"show")}else if(b){e.preventDefault();const a=document.querySelector(r.formSelector);a&&T({url:a.action,method:a.method,data:new FormData(a)},"simpan",()=>t.reload())}})}document.addEventListener("DOMContentLoaded",()=>{const t=m();f(t)});document.addEventListener("shown.bs.modal",async t=>{const e=t.target;try{setTimeout(()=>{const o=e.querySelector("#role");o&&E(o)},100)}catch(o){console.error("Error loading roles select:",o)}});function Y(){if(console.log("🔐 Permissions module initialized successfully!"),document.readyState!=="loading"){const t=m();f(t)}}export{Y as default};

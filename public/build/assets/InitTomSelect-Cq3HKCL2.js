import v from"./tom-select.complete-Dc6LGOTC.js";/* empty css                              */import m from"./axiosClient-DXQnQ5LA.js";function O(f,i,c,t={},e){typeof t=="function"&&(e=t,t={});const n={submitUrl:t.submitUrl||null,fieldMapping:t.fieldMapping||{},buttonId:t.buttonId||"btnActionTomSelect",...t};m.get(f).then(s=>{const a=document.getElementById(i);if(!a)return;a.querySelector(".modal-dialog").innerHTML=s.data;const o=a.querySelector('input[name="name"], input[name="role"]');o&&c&&(o.value=c);const d=a.querySelector("#btnAction");d&&(d.id=n.buttonId);const u=new bootstrap.Modal(a);u.show();const r=a.querySelector("form");r&&r.addEventListener("submit",function(h){h.preventDefault();const g=new FormData(r);Object.keys(n.fieldMapping).forEach(l=>{if(g.has(l)){const p=g.get(l);g.delete(l),g.set(n.fieldMapping[l],p)}});for(let[l,p]of g.entries())console.log(`  ${l}: ${p}`);const I=n.submitUrl||r.action;m.post(I,g).then(l=>{showToast(l.data.message,"success"),e&&e(l.data),u.hide()}).catch(l=>{var p,b,y,S;console.error("Submit error:",l),console.error("Error response:",(p=l.response)==null?void 0:p.data),console.error("Validation errors:",(y=(b=l.response)==null?void 0:b.data)==null?void 0:y.message),console.error("Error status:",(S=l.response)==null?void 0:S.status)})})}).catch(s=>console.error(s))}class x{constructor(i,c={}){const t={valueField:"id",labelField:"name",searchField:["name"],plugins:["virtual_scroll"],maxOptions:200,closeAfterSelect:!1,create:!1,multiple:!1,urlGet:null,urlStore:null,modalId:null,createUrl:null,createSingle:!1};this.settings={...t,...c},this.selector=i,this.ts=null,this.createCallback=null,this.init()}init(){const i=this,c={valueField:this.settings.valueField,labelField:this.settings.labelField,searchField:this.settings.searchField,plugins:this.settings.plugins,maxOptions:this.settings.maxOptions,closeAfterSelect:this.settings.closeAfterSelect,multiple:this.settings.multiple};this.settings.grouped&&(c.optgroupField="optgroup",c.lockOptgroupOrder=!0),this.ts=new v(this.selector,{...c,loadThrottle:250,create:this.settings.create?function(t,e){if(i.settings.createSingle&&i.settings.modalId){document.getElementById(i.settings.modalId);const n={submitUrl:i.settings.urlStore,...i.settings.modalOptions};O(i.settings.createUrl,i.settings.modalId,t,n,s=>{if(s.status==="success"&&s.results){const a={id:s.results.id,name:s.results.name};e&&e(a)}})}else!i.settings.createSingle&&i.settings.urlStore&&m.post(i.settings.urlStore,{name:t}).then(n=>{if(n.data.status==="success"&&n.data.results){const s={id:n.data.results.id,name:n.data.results.name};if(i.settings.grouped){const a=s.name.split(" "),o=a.length>1?a[1]:"other";s.optgroup=o.charAt(0).toUpperCase()+o.slice(1),this.optgroups[s.optgroup]||this.addOptionGroup(s.optgroup,{label:s.optgroup,value:s.optgroup})}showToast(n.data.message,"success"),e(s)}else e()}).catch(n=>{console.error("Create gagal:",n),e()})}:!1,firstUrl:function(t){const e=new URL(i.settings.urlGet,window.location.origin);return e.searchParams.set("search",t||""),e.searchParams.set("page","1"),e.searchParams.set("limit","10"),e.toString()},load:function(t,e){const n=this.getUrl(t);m.get(n).then(s=>{const a=s.data||{};let o,d;if(o=a.data,d=a.has_more||!1,d){const r=new URL(n,window.location.origin),h=parseInt(r.searchParams.get("page")||"1",10)+1;r.searchParams.set("page",h),this.setNextUrl(t,`${r.pathname}?${r.searchParams.toString()}`)}else this.setNextUrl(t,null);e(o);let u=[];i.settings.grouped&&Array.isArray(o)&&o.length>0&&o[0].label&&o[0].options?(o.forEach(r=>{r.label&&this.addOptionGroup(r.label,{label:r.label,value:r.label})}),o.forEach(r=>{r.options&&Array.isArray(r.options)&&r.options.forEach(h=>{u.push({id:h.id,name:h.name,optgroup:r.label})})})):u=Array.isArray(o)?o:[],e(u)}).catch(()=>e())},onFocus:function(){if(this.clearOptions(),typeof this.settings.firstUrl=="function"){const t=this.settings.firstUrl("");this.setNextUrl("",t)}this.load("",()=>{})},onItemAdd:function(){this.setTextboxValue(""),this.refreshOptions(!1)},render:{loading_more:function(){return'<div class="py-2 text-center">Loading more…</div>'},no_more_results:function(){return'<div class="py-2 text-center">No more results</div>'},option:function(t,e){return`<div>${e(t.name)}</div>`},item:function(t,e){return`<div>${e(t.name)}</div>`},option_create:function(t,e){return`<div class="create">+ Tambah "${e(t.input)}"</div>`},optgroup_header:function(t,e){const n=["primary","secondary","success","danger","warning","info","dark"];let s;if(typeof crypto<"u"&&crypto.getRandomValues){const d=new Uint32Array(1);crypto.getRandomValues(d),s=d[0]%n.length}else s=Math.floor(Math.random()*n.length);const a=n[s],o=e(t.label||t);return`<div class="optgroup-header">
                        <span class="badge bg-${a} me-2">${o.charAt(0)}</span>
                        ${o}
                    </div>`}}}),this.settings.preSelectedValues&&this.settings.preSelectedValues.length>0&&(this.settings.urlByIds?m.get(this.settings.urlByIds,{params:{ids:this.settings.preSelectedValues}}).then(t=>{(t.data.data||[]).forEach(n=>{this.ts.addOption(n),this.ts.addItem(n.id,!0)})}).catch(t=>console.error("❌ Error loading selected items (byIds):",t)):m.get(this.settings.urlGet).then(t=>{(t.data.data||[]).filter(s=>this.settings.preSelectedValues.includes(s.id.toString())).forEach(s=>{this.ts.addOption(s),this.ts.addItem(s.id,!0)})}).catch(t=>console.error("❌ Error loading selected items (urlGet):",t)))}addNewItem(i){this.ts.addOption(i),this.ts.addItem(i.id),this.createCallback&&(this.createCallback(i),this.createCallback=null)}}export{x as I};

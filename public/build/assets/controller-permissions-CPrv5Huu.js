const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/permissionsSelect-d09A7nZV.js","assets/InitTomSelect-Cq3HKCL2.js","assets/tom-select.complete-Dc6LGOTC.js","assets/axiosClient-DXQnQ5LA.js","assets/tom-select-CR_xEeZJ.css"])))=>i.map(i=>d[i]);
import{_ as B}from"./preload-helper-BfFHrpNk.js";import{ModernTable as C}from"https://cdn.jsdelivr.net/npm/modern-table-js@1.0.6/core/ModernTable.js";import{D}from"./delete-D9NIfc68.js";import{f as T,c as y,a as A,b as _,g as x,d as E}from"./formatDate-DZoGuVE6.js";import{h as I}from"./handlePermissionButtons-TMegtcb-.js";import{A as P}from"./ActionButton-4FF2Dtnd.js";import{s as i}from"./modalHandler-l1VpEcIP.js";import{f as w}from"./fetchAxios-BCs8Bycy.js";import{f as F,D as v}from"./DateRangePicker-pIMxf9xW.js";import"./axiosClient-DXQnQ5LA.js";import"./badgeUpdater-D7fo0NmU.js";import"./_commonjsHelpers-CqkleIqs.js";const M=x(),p={month:null,year:null,start_date:null,end_date:null,date:M},t={tableId:"#table-controller-permissions",urlWeb:"/admin/controller-permissions/",urlApi:"/api/controller-permissions",deleteMultipleUrl:"/api/controller-permissions/multiple/delete",tableName:"controller-permissions",exportColumns:["controller","method"],createButtonText:"Add Mapping",itemName:"controller-permissions",pageLength:10,lengthMenu:[5,10,25,50],defaultOrder:[[0,"desc"]],dateRangeButtonText:"Filter Tanggal",apiErrorPrefix:"Controller Permissions API Error:",dataLoadedMessage:"‚úÖ Data loaded:",createButtonId:"btnTambah",bulkDeleteButtonId:"delete-selected-btn",dateRangeSelector:"#idFilterDateRange",dateRangeTextSelector:"#idFilterDateRange .date-range-text",actionButtonSelector:"#btnAction",formSelector:".FormAction",deleteButtonClass:".btn-delete",createButtonClass:".btnTambah",updateButtonClass:".buttonUpdate",showButtonClass:".buttonShow"};let f=!1,c={...p};const k=()=>f?Object.fromEntries(Object.entries(c).filter(([o,e])=>e!==null)):{},g=o=>{f=!0,c={...c,...o,date:null}},b=()=>{f=!1,c={...p}},L=A({buttonId:t.bulkDeleteButtonId,countSelector:".selected-count",onSelectionChange:(o,{count:e,hasSelection:r})=>{console.log(`‚ÑπÔ∏è Selection changed: ${e} ${t.itemName} selected`)}}),N=E({deleteUrl:t.deleteMultipleUrl,itemName:t.itemName,onSuccess:(o,e)=>{console.log("‚úÖ Bulk delete success:",o.length,`${t.itemName} deleted`)},onError:o=>{console.error("‚ùå Bulk delete failed:",o)}});function O(){return T(new Date),{...y({url:t.urlApi,beforeSend:e=>Object.assign(e,k()),onSuccess:e=>{var n;const r=(n=e==null?void 0:e.meta)==null?void 0:n.permissions;r&&I(r)},onError:(e,r,n)=>{console.error(t.apiErrorPrefix,{error:e,status:r,message:n})}}),columns:[{data:"DT_RowIndex",title:"No",orderable:!1,searchable:!1},{data:"controller",title:"Controller",orderable:!0},{data:"method",title:"Method",orderable:!0},{data:"permissions",title:"Permissions",orderable:!0,render:e=>{if(!e)return"-";let r;try{if(typeof e=="string")r=JSON.parse(e);else if(Array.isArray(e))r=e;else return e;return Array.isArray(r)?r.map(n=>`<span class="badge bg-primary me-1">${n}</span>`).join(""):r}catch{return e}}},{data:"is_active",title:"Status",orderable:!0,render:e=>e?'<span class="badge bg-success">Aktif</span>':'<span class="badge bg-danger">Nonaktif</span>'},{data:"actions",title:"Action",className:"text-center",orderable:!1,searchable:!1,render:(e,r,n)=>P(n)}],buttons:_({tableName:t.tableName,exportColumns:t.exportColumns,bulkDeleteHandler:N,bulkDeleteButtonId:t.bulkDeleteButtonId,includeCreateButton:!0,createButtonId:t.createButtonId,createButtonText:t.createButtonText,createHandler:()=>{i(`${t.urlWeb}create`,"create")}}),pageLength:t.pageLength,lengthMenu:t.lengthMenu,order:t.defaultOrder,ordering:!0,searching:!0,columnSearch:!0,paging:!0,select:!0,responsive:!0,theme:"auto",onSelectionChange:L,onError:e=>console.error("‚ùå Table error:",e)}}function R(o,e,r){o||e?g({month:o||null,year:e||null}):b(),r.reload()}function $(o,e){if(o){g({start_date:o.start,end_date:o.end});const r=document.querySelector(t.dateRangeTextSelector);r&&(r.textContent=o.formatted)}else b();e.reload()}function h(){const o=O(),e=new C(t.tableId,{...o,initComplete:(r,n)=>{console.log(t.dataLoadedMessage,r.length,"records")}});return F((r,n)=>{R(r,n,e)}),new v(t.dateRangeSelector,{buttonText:t.dateRangeButtonText,onDateSelect:r=>{$(r,e)}}),e}function S(o){D({buttonSelector:t.deleteButtonClass,deleteUrl:t.urlApi+"/",tableSelector:t.tableId,onDeleteSuccess:()=>{o.reload(),o.clearSelection()}}),document.body.addEventListener("click",e=>{const r=e.target.closest(t.updateButtonClass),n=e.target.closest(t.showButtonClass),s=e.target.matches(t.actionButtonSelector);if(e.target.closest(t.createButtonClass))e.preventDefault(),i(`${t.urlWeb}create`,"create");else if(r){e.preventDefault();const a=`${t.urlWeb}${r.dataset.id}/edit`;i(a,"edit")}else if(n){e.preventDefault();const a=`${t.urlWeb}${n.dataset.id}`;i(a,"show")}else if(s){e.preventDefault();const a=document.querySelector(t.formSelector);if(a){const d=new FormData(a);let u="POST";a.method&&typeof a.method=="string"&&(u=a.method.toUpperCase());const m=d.get("_method");m&&typeof m=="string"&&(u=m.toUpperCase(),d.delete("_method")),w({url:a.action,method:u,data:d},"simpan",()=>o.reload())}}})}document.addEventListener("DOMContentLoaded",()=>{const o=h();S(o)});document.addEventListener("shown.bs.modal",async o=>{const e=o.target;try{const{initializePermissionsTomSelect:r}=await B(async()=>{const{initializePermissionsTomSelect:n}=await import("./permissionsSelect-d09A7nZV.js");return{initializePermissionsTomSelect:n}},__vite__mapDeps([0,1,2,3,4]));setTimeout(()=>{const n=e.querySelector("#permissions");if(n){const s=Array.from(n.selectedOptions).map(a=>a.value),l=r(n,{multiple:!0,createSingle:!1,grouped:!0,valueField:"name",labelField:"name"});s.length>0&&(l!=null&&l.ts)&&setTimeout(()=>{s.forEach(a=>{l.ts.addOption({name:a}),l.ts.addItem(a,!0)})},200)}},100)}catch(r){console.error("Error loading permissions select:",r)}});function X(){if(console.log("üîê Controller Permissions module initialized successfully!"),document.readyState!=="loading"){const o=h();S(o)}}export{X as default};
